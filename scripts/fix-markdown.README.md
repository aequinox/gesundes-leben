# Fix Markdown Script

This utility script processes existing markdown files to fix frontmatter issues for compatibility with Astro content collections.

## Purpose

The script addresses two common issues with markdown files generated by the WordPress to Markdown exporter:

1. **heroImage Schema Mismatch**: Converts string heroImage values to the required object format with `src` and `alt` properties.
2. **group Schema Mismatch**: Converts array group values to a single string value from the enum: 'pro', 'kontra', or 'fragezeiten'.

It also performs additional fixes:

- Adds missing `description` field if not present (using excerpt or content)
- Ensures `categories` is a valid array with at least one value
- Validates other frontmatter fields against Astro's schema requirements

## Usage

```bash
node fix-markdown.js <directory> [--extension=.mdx] [--no-recursive]
```

### Arguments

- `<directory>`: (Required) Path to the directory containing markdown files to process
- `--extension=.mdx`: (Optional) File extension to process (default: .mdx)
- `--no-recursive`: (Optional) Disable recursive processing of subdirectories

### Examples

Process all .mdx files in the blog directory and its subdirectories:
```bash
node fix-markdown.js ./src/content/blog
```

Process only .md files in the current directory (non-recursively):
```bash
node fix-markdown.js . --extension=.md --no-recursive
```

## Integration with WordPress to Markdown Exporter

The fix-markdown script is automatically integrated into the WordPress to Markdown exporter workflow. When you run the exporter, it will:

1. Parse the WordPress export file
2. Generate markdown files with frontmatter
3. Download and save images
4. Automatically run the post-processor to fix any schema issues

If the automatic post-processing fails for any reason, you can run the fix-markdown.js script manually to process the generated files.

## How It Works

The script:

1. Recursively scans the specified directory for markdown files with the given extension
2. Parses the frontmatter of each file using js-yaml
3. Applies fixes to the frontmatter based on Astro's schema requirements
4. Writes the updated frontmatter back to the file
5. Reports the number of files processed and any errors encountered

## Dependencies

- js-yaml: For parsing and stringifying YAML frontmatter
- fs: For file system operations
- path: For path manipulation
- logger: For consistent console output
- post-processor: Core module that implements the fixing logic

## Error Handling

The script includes comprehensive error handling:

- Validates command-line arguments
- Reports parsing errors for individual files
- Continues processing even if some files fail
- Provides detailed error messages for troubleshooting
