class f{article;tocList;headings;observer;constructor(){if(this.article=document.querySelector("#article"),this.tocList=document.querySelector("#toc ul"),this.article?this.headings=Array.from(this.article.querySelectorAll("h1, h2, h3, h4")):this.headings=Array.from(document.body.querySelectorAll("h1, h2, h3, h4")),this.headings.length>0){const t=this.headings[0];t&&(t.tagName==="H1"||t.tagName==="H2")&&/inhaltsverzeichnis/i.test((t.textContent||"").trim().toLowerCase())&&(this.headings=this.headings.slice(1))}this.observer=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&this.setSelectedLinkById(e.target.id)})},{root:null,rootMargin:"-120px 0px -60% 0px",threshold:[.5]}),this.initialize()}setSelectedLinkById(t){document.querySelectorAll("#toc li").forEach(i=>i.classList.remove("selected"));const o=document.querySelector(`#toc a[href="#${t}"]`)?.parentElement;o&&(o.classList.add("selected"),this.scrollIntoViewIfNeeded(o))}scrollIntoViewIfNeeded(t){const e=document.querySelector("#toc");if(!e)return;const{top:n,bottom:o}=e.getBoundingClientRect(),{top:i,bottom:s}=t.getBoundingClientRect();(s>o||i<n)&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}createSvgElement(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.classList.add("w-0","h-0","flex-none","text-accent"),t.setAttribute("fill","none"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke","currentColor"),t.setAttribute("aria-hidden","true"),t.innerHTML='<title>Section indicator</title><path stroke-linecap="round" stroke-linejoin="round" d="m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />',t}createLink(t){const e=document.createElement("a");if(!t.id){const i=this.getAccessibleName(t);t.id=this.generateSafeId(i)}e.href=`#${t.id}`;const o=Array.from(t.childNodes).filter(i=>i.nodeType===Node.TEXT_NODE).map(i=>i.textContent?.trim()).filter(i=>!!i).join(" ")||(t.textContent?t.textContent.trim():"");return e.textContent=o,e.setAttribute("aria-label",`Jump to section: ${o}`),e.setAttribute("aria-describedby","toc-heading"),window.location.hash===`#${t.id}`&&e.setAttribute("aria-current","location"),e.addEventListener("click",i=>{i.preventDefault();const s=e.getAttribute("href");if(s!==null&&s.length>1){const r=s.substring(1),c=document.getElementById(r);if(c)try{const h=c.getBoundingClientRect().top+window.scrollY-120;window.scrollTo({top:Math.max(0,h),behavior:"smooth"}),history.pushState(null,"",e.href);const u=c.hasAttribute("tabindex"),d=c.getAttribute("tabindex");c.setAttribute("tabindex","-1"),c.focus({preventScroll:!0}),setTimeout(()=>{u&&d!==null?c.setAttribute("tabindex",d):c.removeAttribute("tabindex")},100);const l=document.createElement("div");l.setAttribute("aria-live","polite"),l.setAttribute("class","sr-only"),l.textContent=`Navigated to section: ${o}`,document.body.appendChild(l),setTimeout(()=>document.body.removeChild(l),1e3),this.setSelectedLinkById(r)}catch{window.location.hash=r}}}),e}createListItem(t){const e=document.createElement("li"),n=t.tagName.toLowerCase();e.className=`toc-level-${n}`;const o={h1:"0px",h2:"8px",h3:"16px",h4:"24px"};o[n]!==void 0&&(e.style.marginLeft=o[n],e.style.paddingLeft="0px");const i=this.createSvgElement(),s=this.createLink(t);return e.appendChild(i),e.appendChild(s),e}initialize(){if(!(!this.tocList||!this.headings.length)){for(;this.tocList.firstChild;)this.tocList.removeChild(this.tocList.firstChild);this.headings.forEach((t,e)=>{if(!t.id){const o=(t.textContent?t.textContent.trim():"")||`heading-${e}`;t.id=this.generateSafeId(o)}const n=this.createListItem(t);this.tocList?.appendChild(n);try{this.observer.observe(t)}catch{}}),this.addKeyboardNavigation(),window.addEventListener("beforeunload",()=>{this.observer.disconnect()})}}getAccessibleName(t){const e=t.getAttribute("aria-label");if(e!==null&&e.length>0)return e;const n=t.getAttribute("aria-labelledby");if(n!==null&&n.length>0){const r=document.getElementById(n)?.textContent;if(r!=null&&r.trim().length>0)return r.trim()}const o=t.querySelector("img");if(o){const s=o.getAttribute("alt");if(s!==null&&s.length>0)return s}const i=t.querySelector("svg");if(i){const r=i.querySelector("title")?.textContent;if(r!=null&&r.trim().length>0)return r.trim()}return(t.textContent?t.textContent.trim():"")||"section"}generateSafeId(t){return t.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]/g,"").replace(/--+/g,"-").replace(/^-+|-+$/g,"")||"section"}addKeyboardNavigation(){if(!this.tocList)return;const t=Array.from(this.tocList.querySelectorAll("a"));t.forEach((e,n)=>{e.addEventListener("keydown",o=>{const i=t;if(i.length)switch(o.key){case"ArrowDown":{o.preventDefault();const s=n<i.length-1?n+1:0;i[s].focus();break}case"ArrowUp":{o.preventDefault();const s=n>0?n-1:i.length-1;i[s].focus();break}case"Home":o.preventDefault(),i[0].focus();break;case"End":o.preventDefault(),i[i.length-1].focus();break}})}),this.tocList.setAttribute("role","navigation")}}class b{progressBars;article;ticking;constructor(){this.progressBars=Array.from(document.querySelectorAll("#progress-top, #progress-aside, #progress-mobile")),this.article=document.querySelector("article"),this.ticking=!1}update(){this.ticking||(this.ticking=!0,requestAnimationFrame(()=>{if(!this.article){this.ticking=!1;return}const t=window.scrollY,e=window.innerHeight,n=document.documentElement.scrollHeight-e,o=Math.max(0,Math.min(100,t/n*100));this.progressBars.forEach(i=>{i.style.width=`${o}%`,i.setAttribute("aria-valuenow",o.toString())}),this.ticking=!1}))}}class p{button;constructor(){this.button=document.getElementById("back-to-top"),this.initialize()}initialize(){this.button?.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}}export{p as BackToTopButton,b as ScrollProgress,f as TableOfContents};
