@plugin '@tailwindcss/typography';

/* Modern Typography System - 2025 */
@layer base {
  /* Tailwind Typography Custom Properties - Override defaults */
  :root {
    /* Tailwind prose color variables */
    --tw-prose-body: var(--foreground);
    --tw-prose-headings: var(--foreground);
    --tw-prose-lead: var(--foreground);
    --tw-prose-links: var(--accent);
    --tw-prose-bold: var(--foreground);
    --tw-prose-counters: var(--muted);
    --tw-prose-bullets: var(--muted);
    --tw-prose-hr: var(--border);
    --tw-prose-quotes: var(--foreground);
    --tw-prose-quote-borders: var(--border);
    --tw-prose-captions: var(--muted);
    --tw-prose-code: var(--foreground);
    --tw-prose-pre-code: var(--foreground);
    --tw-prose-pre-bg: var(--card);
    --tw-prose-th-borders: var(--border);
    --tw-prose-td-borders: var(--border);

    /* Base font sizes with fluid scaling */
    --font-size-xs: clamp(0.75rem, 0.7rem + 0.25vw, 0.875rem);
    --font-size-sm: clamp(0.875rem, 0.8rem + 0.375vw, 1rem);
    --font-size-base: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
    --font-size-lg: clamp(1.125rem, 1rem + 0.625vw, 1.25rem);
    --font-size-xl: clamp(1.25rem, 1.1rem + 0.75vw, 1.5rem);
    --font-size-2xl: clamp(1.5rem, 1.3rem + 1vw, 1.875rem);
    --font-size-3xl: clamp(1.875rem, 1.6rem + 1.375vw, 2.25rem);
    --font-size-4xl: clamp(2.25rem, 1.9rem + 1.75vw, 3rem);
    --font-size-5xl: clamp(3rem, 2.4rem + 3vw, 4rem);

    /* Modern font stacks */
    --font-display:
      "Montserrat Variable", "Inter Variable", ui-sans-serif, system-ui,
      sans-serif;
    --font-body:
      "Inter Variable", -apple-system, BlinkMacSystemFont, "Segoe UI Variable",
      ui-sans-serif, system-ui, sans-serif;
    --font-mono:
      "JetBrains Mono Variable", "Fira Code Variable", "Cascadia Code",
      ui-monospace, monospace;

    /* Reading-optimized line heights */
    --line-height-tight: 1.2;
    --line-height-base: 1.6;
    --line-height-relaxed: 1.8;

    /* Modern letter spacing */
    --letter-spacing-tight: -0.025em;
    --letter-spacing-normal: 0em;
    --letter-spacing-wide: 0.025em;
    --letter-spacing-wider: 0.05em;

    /* Content width for optimal reading */
    --content-width: min(65ch, 90vw);
    --content-width-wide: min(75ch, 95vw);
  }

  /* Enhanced base typography */
  html {
    font-synthesis: none;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-feature-settings:
      "kern" 1,
      "liga" 1,
      "calt" 1;
  }

  body {
    font-family:
      var(--font-body), "Inter Variable", ui-sans-serif, system-ui, sans-serif;
    font-size: var(--font-size-base, 1rem);
    line-height: var(--line-height-base, 1.6);
    letter-spacing: var(--letter-spacing-normal);
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;

    /* Enhanced text selection */
    -webkit-user-select: auto;
    -moz-user-select: auto;
    user-select: auto;
  }

  /* Modern heading hierarchy */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-display);
    font-weight: 600;
    letter-spacing: var(--letter-spacing-tight);
    line-height: var(--line-height-tight);
    text-wrap: balance;
    margin-block: 0;
  }

  h1 {
    font-size: var(--font-size-4xl);
    font-weight: 700;
    letter-spacing: -0.02em;
  }

  h2 {
    font-size: var(--font-size-3xl);
    margin-block: 2rem 1rem;
  }

  h3 {
    font-size: var(--font-size-2xl);
    margin-block: 1.5rem 0.75rem;
  }

  h4 {
    font-size: var(--font-size-xl);
    margin-block: 1.25rem 0.5rem;
  }

  h5,
  h6 {
    font-size: var(--font-size-lg);
    margin-block: 1rem 0.5rem;
  }

  /* Optimized paragraph typography */
  p {
    font-size: var(--font-size-base);
    line-height: var(--line-height-base);
    margin-block: 0 1.25rem;
    text-wrap: pretty;
    hanging-punctuation: first last;
  }

  /* Enhanced prose styles */
  .prose {
    /* Modern prose foundation */
    max-width: var(--content-width);
    font-family: var(--font-body);

    /* Improved heading styles */
    & :is(h1, h2, h3, h4, h5, h6) {
      font-family: var(--font-display);
      letter-spacing: var(--letter-spacing-tight);
      text-wrap: balance;
    }

    & h1 {
      font-size: var(--font-size-4xl);
      font-weight: 700;
      line-height: var(--line-height-tight);
    }

    & h2 {
      font-size: var(--font-size-3xl);
      font-weight: 600;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }

    & h3 {
      font-size: var(--font-size-2xl);
      font-weight: 500;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
    }

    /* Enhanced text styles */
    & p {
      text-wrap: pretty;
      line-height: var(--line-height-relaxed);
      color: var(--foreground);
      margin-bottom: 1.5rem;
    }

    /* Bold text styling - Critical for dark mode */
    & strong,
    & b {
      color: var(--foreground);
      font-weight: 700;
    }

    /* Italic text styling */
    & em,
    & i {
      color: var(--foreground);
      font-style: italic;
    }

    /* Other text elements */
    & span {
      color: inherit;
    }

    /* Modern link styling */
    & a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
      text-decoration: underline;
      text-decoration-color: oklch(from var(--accent) l c h / 0.3);
      text-decoration-thickness: 2px;
      text-underline-offset: 4px;
      transition: text-decoration-color var(--duration-normal)
        var(--easing-standard);
    }

    & a:hover {
      text-decoration-color: var(--accent);
    }

    /* Enhanced code styling */
    & code {
      background: oklch(from var(--muted) l c h / 0.5);
      padding: 0.25rem 0.375rem;
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-family: var(--font-mono);
      border: 1px solid oklch(from var(--border) l c h / 0.5);
    }

    & code::before,
    & code::after {
      content: none;
    }

    /* Improved blockquote styling */
    & blockquote {
      border-left: 4px solid oklch(from var(--accent) l c h / 0.3);
      background: oklch(from var(--card) l c h / 0.5);
      padding: 1rem 1.5rem;
      border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
      font-weight: 500;
      color: oklch(from var(--foreground) calc(l * 0.8) c h);
      font-style: italic;
      margin: 1.5rem 0;
    }

    /* Enhanced list styling */
    & ul {
      list-style: none;
      padding-left: 0;
    }

    & li {
      position: relative;
      padding-left: 2rem;
      margin-bottom: 0.5rem;
    }

    & li::before {
      content: "â–¸";
      position: absolute;
      left: 0;
      color: var(--accent);
      font-weight: 700;
    }

    /* Table improvements */
    & table {
      border-collapse: collapse;
      border-spacing: 0;
      width: 100%;
      margin: 1.5rem 0;
    }

    & th {
      background: var(--card);
      font-weight: 600;
      text-align: left;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
    }

    & td {
      padding: 0.75rem 1rem;
      border: 1px solid var(--border);
    }

    /* Image enhancements */
    & img {
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-elevation-medium);
      border: 1px solid oklch(from var(--border) l c h / 0.2);
    }

    & figcaption {
      text-align: center;
      font-size: var(--font-size-sm);
      color: var(--muted);
      margin-top: 0.5rem;
    }
  }

  /* Reading experience optimizations */
  .prose-enhanced {
    /* Optimal reading width */
    max-width: var(--content-width);

    /* Enhanced readability */
    hyphens: auto;
    hyphenate-limit-chars: 6 3 3;
    hyphenate-limit-lines: 2;
    hyphenate-limit-last: always;
    hyphenate-limit-zone: 8%;

    /* Modern text features */
    font-variant-ligatures: common-ligatures contextual;
    font-variant-numeric: oldstyle-nums proportional-nums;
    font-feature-settings:
      "kern" 1,
      "liga" 1,
      "calt" 1,
      "onum" 1,
      "pnum" 1;
  }

  /* Table of Contents styling */
  .toc {
    background: oklch(from var(--card) l c h / 0.3);
    border: 1px solid oklch(from var(--border) l c h / 0.5);
    border-radius: var(--radius-xl);
    padding: 1.5rem;
    backdrop-filter: blur(4px);

    details {
      cursor: pointer;
      user-select: none;

      summary {
        font-weight: 600;
        color: var(--foreground);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: color 200ms var(--easing-standard);

        &:hover {
          color: var(--accent);
        }

        &::before {
          content: "ðŸ“‘";
          font-size: var(--font-size-base);
        }

        &::after {
          content: "Inhaltsverzeichnis anzeigen";
          font-size: var(--font-size-sm);
          color: var(--muted);
        }
      }

      &[open] summary::after {
        content: "Inhaltsverzeichnis verbergen";
      }

      ul {
        margin-top: 1rem;
        font-size: var(--font-size-sm);
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: all 300ms ease-out;

        li {
          padding-left: 1rem;
          border-left: 2px solid transparent;
          margin-bottom: 0.5rem;
          transition: border-color 200ms var(--easing-standard);

          &:hover {
            border-left-color: oklch(from var(--accent) l c h / 0.3);
          }

          a {
            color: oklch(from var(--foreground) calc(l * 0.85) c h);
            text-decoration: none;
            font-weight: 500;
            transition: color 200ms var(--easing-standard);

            &:hover {
              color: var(--accent);
            }
          }
        }
      }

      &[open] ul {
        max-height: 24rem;
        opacity: 1;
      }
    }
  }

  /* Mobile typography optimizations */
  @media (max-width: 640px) {
    .prose {
      & h1 {
        font-size: var(--font-size-2xl);
      }
      & h2 {
        font-size: var(--font-size-xl);
      }
      & h3 {
        font-size: var(--font-size-lg);
      }
      & p {
        font-size: var(--font-size-base);
        line-height: var(--line-height-relaxed);
      }
    }
  }

  /* Dark mode typography adjustments */
  html[data-theme="dark"] {
    /* Override Tailwind prose variables for dark mode */
    --tw-prose-body: var(--foreground);
    --tw-prose-headings: var(--foreground);
    --tw-prose-lead: var(--foreground);
    --tw-prose-links: var(--accent);
    --tw-prose-bold: var(--foreground);
    --tw-prose-counters: var(--muted);
    --tw-prose-bullets: var(--muted);
    --tw-prose-hr: var(--border);
    --tw-prose-quotes: var(--foreground);
    --tw-prose-quote-borders: var(--border);
    --tw-prose-captions: var(--muted);
    --tw-prose-code: var(--foreground);
    --tw-prose-pre-code: var(--foreground);
    --tw-prose-pre-bg: var(--card);
    --tw-prose-th-borders: var(--border);
    --tw-prose-td-borders: var(--border);

    .prose {
      & :is(h1, h2, h3, h4, h5, h6) {
        color: var(--foreground);
      }

      & p {
        color: var(--foreground);
      }

      & strong,
      & b {
        color: var(--foreground) !important;
        font-weight: 700;
      }

      & em,
      & i {
        color: var(--foreground);
      }

      & code {
        background: oklch(from var(--card) l c h / 0.8);
        color: var(--foreground);
      }

      & blockquote {
        background: oklch(from var(--card) l c h / 0.3);
        color: oklch(from var(--foreground) calc(l * 0.9) c h);
      }
    }
  }

  /* Print optimizations */
  @media print {
    .prose {
      font-size: 12pt;
      line-height: 1.5;
      max-width: none;

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        break-after: avoid;
        page-break-after: avoid;
      }

      p,
      li {
        break-inside: avoid;
        page-break-inside: avoid;
      }
    }
  }
}
