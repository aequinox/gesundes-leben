@plugin '@tailwindcss/typography';

@layer base {
  /* Tailwind Typography Custom Properties - Override defaults */
  :root {
    /* Base font sizes with fluid scaling - Optimized for 2024 standards */
    --font-size-xs: clamp(0.75rem, 0.7rem + 0.2vw, 0.8125rem);
    --font-size-sm: clamp(0.875rem, 0.8rem + 0.3vw, 0.9375rem);
    --font-size-base: clamp(1rem, 0.9rem + 0.4vw, 1.0625rem);
    --font-size-lg: clamp(1.125rem, 1rem + 0.5vw, 1.1875rem);
    --font-size-xl: clamp(1.25rem, 1.1rem + 0.75vw, 1.5rem);
    --font-size-2xl: clamp(1.5rem, 1.3rem + 1vw, 1.875rem);
    --font-size-3xl: clamp(1.875rem, 1.6rem + 1.375vw, 2.25rem);
    --font-size-4xl: clamp(2.25rem, 1.9rem + 1.75vw, 3rem);
    --font-size-5xl: clamp(3rem, 2.4rem + 3vw, 4rem);

    /* Reading-optimized line heights */
    --line-height-tight: 1.2;
    --line-height-base: 1.6;
    --line-height-relaxed: 1.8;

    /* Modern letter spacing */
    --letter-spacing-tight: -0.025em;
    --letter-spacing-normal: 0em;
    --letter-spacing-wide: 0.025em;
    --letter-spacing-wider: 0.05em;

    /* Content width for optimal reading */
    --content-width: min(65ch, 90vw);
    --content-width-wide: min(75ch, 95vw);
  }

  /* Enhanced base typography */
  html {
    font-synthesis: none;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-feature-settings:
      "kern" 1,
      "liga" 1,
      "calt" 1;
  }

  .prose {
    /* Modern prose foundation */
    max-width: var(--content-width);
    font-family: var(--font-body);

    @apply prose-headings:!mb-3 prose-h3:italic prose-p:!text-foreground prose-a:!text-foreground prose-a:!decoration-solid prose-a:!decoration-from-font prose-a:underline-offset-4 hover:prose-a:text-accent prose-blockquote:!border-l-accent/50 prose-figcaption:!text-foreground prose-figcaption:opacity-70 prose-strong:!text-foreground prose-code:rounded prose-code:bg-muted/75 prose-code:p-1 prose-code:!text-foreground prose-code:before:!content-none prose-code:after:!content-none prose-ol:!text-foreground prose-ul:overflow-x-clip prose-ul:!text-foreground prose-li:marker:!text-accent prose-table:text-foreground prose-th:border prose-th:border-border prose-td:border prose-td:border-border prose-img:mx-auto prose-img:!my-2 prose-img:border-2 prose-img:border-border prose-hr:!border-border;
    /* @apply prose-headings:!mb-3 prose-headings:!text-foreground prose-h3:italic prose-p:!text-foreground prose-a:!text-foreground prose-a:!decoration-solid prose-a:!decoration-from-font prose-a:underline-offset-4 hover:prose-a:text-accent prose-blockquote:!border-l-accent/50 prose-figcaption:!text-foreground prose-figcaption:opacity-70 prose-strong:!text-foreground prose-code:rounded prose-code:bg-muted/75 prose-code:p-1 prose-code:!text-foreground prose-code:before:!content-none prose-code:after:!content-none prose-ol:!text-foreground prose-ul:overflow-x-clip prose-ul:!text-foreground prose-li:marker:!text-accent prose-table:text-foreground prose-th:border prose-th:border-border prose-td:border prose-td:border-border prose-img:mx-auto prose-img:!my-2 prose-img:border-2 prose-img:border-border prose-hr:!border-border; */

    /* Improved heading styles */
    & :is(h1, h2, h3, h4, h5, h6) {
      color: var(--color-foreground) !important;
      font-family: var(--font-body);
      letter-spacing: var(--letter-spacing-tight);
      text-wrap: balance;
    }

    & h1 {
      font-size: var(--font-size-4xl);
      font-weight: 700;
      line-height: var(--line-height-tight);
    }

    & h2 {
      font-size: var(--font-size-3xl);
      font-weight: 600;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }

    & h3 {
      font-size: var(--font-size-2xl);
      font-weight: 500;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
    }

    /* TOC */
    details > ul {
      @apply max-h-0 overflow-hidden text-sm opacity-0;
      transition:
        opacity 300ms ease-in-out,
        max-height 500ms ease-in-out;

      li a {
        @apply !no-underline;

        &:hover {
          @apply !underline !decoration-wavy;
        }
      }
    }

    details[open] > ul {
      @apply max-h-[1000px] opacity-100;
    }
  }
  .prose a {
    @apply break-words hover:!text-accent;
  }
  .prose thead th:first-child,
  tbody td:first-child,
  tfoot td:first-child {
    padding-inline-start: 0.5714286em !important;
  }
  .prose h2#table-of-contents {
    @apply mb-2;
  }
  details {
    @apply -mt-4 -ml-2 cursor-pointer rounded-sm p-2 text-foreground select-none;
    & > ul {
      @apply -translate-y-3 transform rounded-sm bg-card py-4 opacity-0 transition-opacity duration-300 ease-in-out;

      & > li {
        @apply mx-2;
      }
    }

    &[open] > ul {
      transform: translateY(0);
      opacity: 1;
    }
    summary {
      @apply inline-block overflow-hidden rounded-sm p-2 transition delay-150 duration-300 ease-in-out hover:-translate-y-1;
      &::before {
        content: "ðŸ¡‘";
        @apply mr-2 inline-block transform transition-transform duration-300 ease-in-out;
      }
      &::after {
        content: "Anzeigen";
        margin-left: 0.25em;
        @apply inline-block translate-y-0 transform transition-transform duration-300 ease-in-out;
      }
    }
    &[open] summary {
      @apply inline-block;
      &::before {
        @apply mr-2 rotate-180;
      }
      &::after {
        content: "Verbergen";
        margin-right: 0.25em;
        @apply inline-block transform transition-transform duration-300 ease-in-out;
      }
    }
  }

  .prose h2#table-of-contents + p {
    @apply hidden;
  }

  /* ===== Code Blocks & Syntax Highlighting ===== */
  pre:has(code) {
    @apply border border-border;
  }

  .prose code,
  .prose blockquote {
    @apply break-words;
  }

  .prose table code {
    /* add line breaks whenever necessary for codes under table */
    @apply break-all sm:break-normal;
  }

  pre > code {
    white-space: pre;
  }

  /* Apply Dark Theme (if multi-theme specified) */
  html[data-theme="dark"] pre:has(code),
  html[data-theme="dark"] pre:has(code) span {
    color: var(--shiki-dark) !important;
    background-color: var(--shiki-dark-bg) !important;
    font-style: var(--shiki-dark-font-style) !important;
    font-weight: var(--shiki-dark-font-weight) !important;
    text-decoration: var(--shiki-dark-text-decoration) !important;
  }
}
