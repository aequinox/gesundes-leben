---
/**
 * CardImage Component
 * Displays the hero image with overlay, light reflection, and group badge
 */

import { Icon } from "astro-icon/components";
import { Picture } from "astro:assets";

import type { Post } from "@/utils/types";
import {  getPostHeroImageTransition } from "@/utils/viewTransitionNames";

interface GroupConfig {
  type: string;
  icon: string;
  label: string;
  gradient: string;
}

export interface Props {
  post: Post;
  href: string;
  isSmall: boolean;
  loading?: "eager" | "lazy";
  groupConfig?: GroupConfig;
}

const { post, href, isSmall, loading = "eager", groupConfig } = Astro.props;
const { title, heroImage } = post.data;
---

{
  heroImage && (
    <div class="card-image-container relative cursor-pointer overflow-hidden">
      <a
        href={href}
        aria-label={`Read more about ${title}`}
        class="card-image-link relative block overflow-hidden"
      >
        <div class="card-image-overlay absolute inset-0 z-10 bg-linear-to-t from-black/50 via-black/20 to-transparent opacity-40" />

        <div class="card-light-reflection absolute inset-0 z-20 bg-linear-to-tr from-white/0 via-white/8 to-white/0 opacity-0" />

        <Picture
          src={heroImage.src}
          formats={["avif", "webp"]}
          widths={[400, 600, 800, 1200]}
          width={800}
          height={isSmall ? 600 : 450}
          sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, (max-width: 1536px) 33vw, 400px"
          alt={title}
          loading={loading}
          fetchpriority={loading === "eager" ? "high" : "auto"}
          class={`card-image w-full object-cover transition-transform duration-600 ease-out ${
            isSmall ? "aspect-4/3" : "aspect-video"
          }`}
          transition:name={getPostHeroImageTransition(post)}
        />
      </a>

      {groupConfig?.icon && groupConfig.icon.trim() !== "" && (
        <div
          class={`card-badge absolute z-30 rounded-full border border-white/15 bg-white text-white shadow-lg backdrop-blur-md transition-all duration-300 ${
            groupConfig?.gradient
          } ${
            isSmall
              ? "right-2 bottom-2 px-2 py-1"
              : "right-3 bottom-3 px-2.5 py-2.5"
          }`}
          style="backdrop-filter: blur(12px) saturate(180%);"
          aria-label={groupConfig?.label}
        >
          <Icon
            name={groupConfig.icon}
            class={`card-badge-icon transition-transform duration-300 ${
              isSmall ? "h-4 w-4" : "h-5 w-5"
            }`}
            aria-hidden="true"
          />
        </div>
      )}
    </div>
  )
}
