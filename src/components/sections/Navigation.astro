---
import LinkButton from "@/components/elements/LinkButton.astro";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import type { NavigationLink } from "@/data/navigation";
import { LOGO_IMAGE, SITE } from "@/config";
import Icon from "@/components/elements/Icon.astro";

export interface Props {
  /** The currently active navigation link */
  activeNav?: NavigationLink;
}

const { activeNav } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Navigation links configuration
const NAV_LINKS = [
  { href: "/posts/", key: "posts" as const, label: t("nav.posts") },
  {
    href: "/categories/",
    key: "categories" as const,
    label: t("nav.categories"),
  },
  { href: "/tags/", key: "tags" as const, label: t("nav.tags") },
  { href: "/glossary/", key: "glossary" as const, label: t("nav.glossary") },
  { href: "/about/", key: "about" as const, label: t("nav.about") },
];

interface ActionButton {
  href: string;
  key: NavigationLink;
  label: string;
  icon: "archive" | "search";
  showTextOnMobile: boolean;
}

// Action buttons configuration
const ACTION_BUTTONS = [
  SITE.showArchives && {
    href: "/archives/",
    key: "archives",
    label: "Archives",
    icon: "archive",
    showTextOnMobile: true,
  },
  SITE.showSearch && {
    href: "/search/",
    key: "search",
    label: t("nav.search"),
    icon: "search",
    showTextOnMobile: false,
  },
].filter((button): button is ActionButton => Boolean(button));
---

<header
  id="navbar"
  class="sticky top-0 z-20 w-full backdrop-blur-md transition-all duration-200 ease-in-out"
  role="banner"
>
  <div class="nav-container">
    <div
      class="relative flex w-full items-start justify-between p-4 md:items-center md:py-4"
    >
      <!-- Logo -->
      <a
        id="logo"
        href="/"
        class="logo scale-105 whitespace-nowrap"
        aria-label={SITE.title}
      >
        {
          LOGO_IMAGE.enable ? (
            <img
              src={`/assets/${LOGO_IMAGE.svg ? "logo.svg" : "logo.png"}`}
              alt={SITE.title}
              width={LOGO_IMAGE.width}
              height={LOGO_IMAGE.height}
              loading="eager"
            />
          ) : (
            SITE.title
          )
        }
      </a>

      <!-- Navigation Menu -->
      <nav id="nav-menu" aria-label="Main navigation">
        <input
          type="checkbox"
          id="nav-toggle"
          class="nav-toggle"
          aria-hidden="true"
        />
        <label
          for="nav-toggle"
          class="nav-toggle-label"
          aria-label="Toggle navigation menu"
        >
          <span class="hamburger" aria-hidden="true">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
          </span>
        </label>

        <ul id="menu-items" class="menu-items" role="menubar">
          {/* Navigation Links */}
          {
            NAV_LINKS.map(({ href, key, label }) => (
              <li role="none">
                <a
                  href={href}
                  class={activeNav === key ? "active" : ""}
                  role="menuitem"
                  aria-current={activeNav === key ? "page" : undefined}
                >
                  {label}
                </a>
              </li>
            ))
          }

          {/* Action Buttons */}
          <div
            class="action-buttons"
            role="group"
            aria-label="Additional actions"
          >
            {
              ACTION_BUTTONS.map(
                ({ href, key, label, icon, showTextOnMobile }) => (
                  <li role="none">
                    <LinkButton
                      href={href}
                      className={`focus-outline flex justify-center p-3 sm:p-1 ${
                        activeNav === key ? "active" : ""
                      }`}
                      ariaLabel={label}
                      title={label}
                    >
                      <Icon name={icon} active={activeNav === key} />
                      <span
                        class:list={[
                          showTextOnMobile ? "sm:sr-only" : "sr-only",
                          activeNav === key && "active",
                        ]}
                      >
                        {label}
                      </span>
                    </LinkButton>
                  </li>
                )
              )
            }

            {/* Theme Toggle Button */}
            {
              SITE.lightAndDarkMode && (
                <li role="none">
                  <button
                    id="theme-btn"
                    class="focus-outline p-3 md:p-1"
                    title={t("nav.themeToggle")}
                    aria-label="auto"
                    aria-live="polite"
                  >
                    <Icon name="moon" id="moon-svg" />
                    <Icon name="sun" id="sun-svg" />
                  </button>
                </li>
              )
            }
          </div>
        </ul>
      </nav>
    </div>
  </div>
</header>

<style>
  /* Navigation Toggle */
  .nav-toggle {
    @apply hidden;
  }

  .nav-toggle-label {
    @apply self-end p-2 outline-2 outline-offset-1 outline-skin-fill focus-visible:no-underline focus-visible:outline-dashed md:hidden cursor-pointer;
  }

  /* Menu Items */
  .menu-items {
    @apply hidden absolute right-4 left-4 top-full mt-2 p-2 rounded-lg border-2 border-skin-inverted bg-skin-fill/95 shadow-lg
    md:flex md:static md:mt-0 md:p-0 md:border-none md:shadow-none md:bg-transparent;
  }

  .nav-toggle:checked ~ .menu-items {
    @apply flex flex-col;
  }

  /* Hamburger Menu */
  .hamburger {
    @apply flex flex-col justify-between w-6 h-5;
  }

  .hamburger .line {
    @apply block w-full h-0.5 bg-current transition-transform duration-300 ease-in-out;
  }

  .nav-toggle:checked ~ .nav-toggle-label .hamburger .line:nth-child(1) {
    @apply translate-y-[9px] rotate-45;
  }

  .nav-toggle:checked ~ .nav-toggle-label .hamburger .line:nth-child(2) {
    @apply opacity-0;
  }

  .nav-toggle:checked ~ .nav-toggle-label .hamburger .line:nth-child(3) {
    @apply -translate-y-[9px] -rotate-45;
  }

  /* Navigation Layout */
  nav {
    @apply flex flex-col items-center w-full md:ml-2 md:flex-row md:justify-end md:space-x-4 md:py-0;
  }

  nav ul li {
    @apply flex items-center justify-center;
  }

  nav ul li a {
    @apply w-full px-4 py-3 text-center font-medium hover:text-skin-accent md:my-0 md:px-2 md:py-1;
  }

  nav a.active {
    @apply underline decoration-wavy decoration-2 underline-offset-4;
  }

  nav a.active svg {
    @apply fill-skin-accent;
  }

  nav button {
    @apply p-1;
  }

  nav button svg {
    @apply h-6 w-6 fill-skin-base hover:fill-skin-accent scale-125 hover:rotate-12 md:scale-100;
  }

  /* Navigation Shrink Effect */
  .nav-shrink {
    @apply h-14 bg-skin-fill/75 shadow-lg;
  }

  /* Action Buttons */
  .action-buttons {
    @apply grid grid-cols-3 gap-2 w-full md:contents;
  }
</style>
