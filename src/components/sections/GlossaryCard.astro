---
/**
 * GlossaryCard Component
 *
 * A card component for displaying glossary entries with title, content,
 * and navigation. Supports view transitions and accessibility features.
 *
 * @component
 * @example
 * ```astro
 * <GlossaryCard
 *   post={glossaryEntry}
 *   loading="lazy"
 * />
 * ```
 */

import { type CollectionEntry } from "astro:content";
import { slugService } from "@/services/format/SlugService";
import { Icon } from "astro-icon/components";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";

export interface Props {
  /** The glossary entry to display */
  post: CollectionEntry<"glossary">;
  /** Whether to use secondary heading style */
  secHeading?: boolean;
  /** Image loading strategy */
  loading?: "eager" | "lazy";
}

const { post }: Props = Astro.props;
// const { post, loading = "lazy" }: Props = Astro.props;

const {
  slug,
  data: { title },
} = post;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const href = `/glossary/${slug}/`;

// Get rendered content
const { Content } = await post.render();

// Memoize common class names
const cardClasses = [
  "article-card",
  "flex flex-col justify-between",
  "overflow-hidden rounded-sm",
  "bg-skin-card/10 hover:bg-skin-card/30",
  "hover:shadow-lg",
  "transition-all duration-300",
].join(" ");

const titleClasses = [
  "text-lg font-medium",
  "transition-colors duration-300",
  "hover:text-skin-accent",
].join(" ");

const readMoreClasses = [
  "mr-2 mt-4",
  "inline-flex items-center gap-2",
  "text-sm font-bold uppercase",
  "transition-colors duration-300",
  "group-hover:text-skin-accent",
].join(" ");

// Memoize translated strings
const readMoreLabel = t("glossary.readMoreLabel");
const readMoreAriaLabel = t("glossary.readMore").replace("{title}", title);
const excerptAriaLabel = t("glossary.excerpt");
---

<article class={cardClasses} aria-labelledby={`glossary-title-${slug}`}>
  <div class="w-full">
    <div class="p-4">
      <div class="mb-4">
        <h2
          id={`glossary-title-${slug}`}
          class={titleClasses}
          transition:name={slugService.slugifyStr(title)}
        >
          {title}
        </h2>

        <div
          class="prose prose-sm mt-2 line-clamp-3 text-skin-base/80"
          aria-label={excerptAriaLabel}
        >
          <Content />
        </div>
      </div>
    </div>

    <div class="group mt-auto pb-4 pl-4">
      <a href={href} class={readMoreClasses} aria-label={readMoreAriaLabel}>
        {readMoreLabel}
        <Icon
          name="tabler:arrow-right"
          class="h-5 w-5 transition-transform duration-300 group-hover:translate-x-1"
          aria-hidden="true"
        />
      </a>
    </div>
  </div>
</article>

<style>
  /* Animation keyframes */
  @keyframes hide {
    from {
      opacity: 1;
      transform: scale(1);
    }
    to {
      opacity: 0;
      transform: scale(0);
    }
  }

  @keyframes show {
    from {
      opacity: 0;
      transform: scale(0);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Animation classes */
  .hide {
    display: none;
    animation: hide 100ms ease-in-out;
  }

  .show {
    display: block;
    animation: show 400ms ease-in-out;
  }

  /* Focus styles */
  article:focus-within {
    @apply ring-2 ring-skin-accent ring-offset-2;
  }

  /* Link focus styles */
  a:focus-visible {
    @apply outline-none ring-2 ring-skin-accent ring-offset-2;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .transition-all,
    .transition-colors,
    .transition-transform,
    .group-hover\:translate-x-1 {
      @apply transform-none transition-none;
    }

    .hide,
    .show {
      animation: none;
    }
  }

  /* Print styles */
  @media print {
    article {
      @apply break-inside-avoid shadow-none;
    }

    .group-hover\:translate-x-1 {
      @apply transform-none;
    }
  }

  /* High contrast mode */
  @media (forced-colors: active) {
    article {
      @apply border border-[CanvasText];
    }
  }
</style>
