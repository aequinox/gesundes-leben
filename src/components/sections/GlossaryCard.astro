---
/**
 * GlossaryCard Component - 2025 Modern Design
 *
 * A card component for displaying glossary entries with title, content,
 * and navigation. Features modern design elements with interactive hover effects.
 *
 * @component
 * @example
 * ```astro
 * <GlossaryCard
 *   post={glossaryEntry}
 * />
 * ```
 */

import { type CollectionEntry } from "astro:content";
import { slugService } from "@/services/format/SlugService";
import { Icon } from "astro-icon/components";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";

export interface Props {
  /** The glossary entry to display */
  post: CollectionEntry<"glossary">;
  /** Whether to use secondary heading style */
  secHeading?: boolean;
  /** Image loading strategy */
  loading?: "eager" | "lazy";
}

const { post }: Props = Astro.props;

const {
  slug,
  data: { title },
} = post;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const href = `/glossary/${slug}/`;

// Get rendered content
const { Content } = await post.render();

// Memoize translated strings
const readMoreLabel = t("glossary.readMoreLabel");
const readMoreAriaLabel = t("glossary.readMore").replace("{title}", title);
const excerptAriaLabel = t("glossary.excerpt");
---

<article class="glossary-card" aria-labelledby={`glossary-title-${slug}`}>
  <div class="card-content">
    <div class="card-header">
      <div class="card-icon">
        <Icon name="tabler:book" class="icon" aria-hidden="true" />
      </div>
      <h2
        id={`glossary-title-${slug}`}
        class="card-title"
        transition:name={slugService.slugifyStr(title)}
      >
        {title}
      </h2>
    </div>

    <div class="card-excerpt" aria-label={excerptAriaLabel}>
      <Content />
    </div>

    <div class="card-footer">
      <a href={href} class="read-more-link" aria-label={readMoreAriaLabel}>
        <span>{readMoreLabel}</span>
        <Icon name="tabler:arrow-right" class="arrow-icon" aria-hidden="true" />
      </a>
    </div>
  </div>
</article>

<style>
  /* Card styles */
  .glossary-card {
    @apply overflow-hidden rounded-xl bg-white shadow-lg transition-all duration-300 hover:-translate-y-2 hover:shadow-xl dark:bg-gray-800;
  }

  .card-content {
    @apply flex h-full flex-col p-6;
  }

  .card-header {
    @apply mb-4 flex items-center gap-4;
  }

  .card-icon {
    @apply flex h-12 w-12 items-center justify-center rounded-full bg-skin-accent/10 transition-all duration-300;
  }

  .icon {
    @apply h-6 w-6 fill-skin-accent transition-all duration-300;
  }

  .card-title {
    @apply text-xl font-semibold text-skin-base transition-all duration-300;
  }

  .card-excerpt {
    @apply line-clamp-3 text-skin-base/80;
  }

  /* Apply prose styles without nesting */
  .card-excerpt :global(p) {
    @apply text-sm leading-relaxed;
    margin-bottom: 0.75em;
  }

  .card-excerpt :global(a) {
    @apply text-skin-accent underline;
  }

  .card-excerpt :global(strong) {
    @apply font-semibold;
  }

  .card-excerpt :global(em) {
    @apply italic;
  }

  .card-footer {
    @apply mt-auto pt-4;
  }

  .read-more-link {
    @apply inline-flex items-center gap-2 font-medium text-skin-accent no-underline transition-all duration-300 hover:text-skin-accent/80;
  }

  .arrow-icon {
    @apply h-5 w-5 transition-transform duration-300;
  }

  /* Hover effects */
  .glossary-card:hover .card-icon {
    @apply bg-skin-accent;
  }

  .glossary-card:hover .icon {
    @apply fill-white;
  }

  .glossary-card:hover .read-more-link .arrow-icon {
    @apply translate-x-1;
  }

  /* Focus styles */
  .glossary-card:focus-within {
    @apply ring-2 ring-skin-accent ring-offset-2;
  }

  .read-more-link:focus-visible {
    @apply outline-none ring-2 ring-skin-accent ring-offset-2;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .glossary-card,
    .card-icon,
    .icon,
    .card-title,
    .read-more-link,
    .arrow-icon {
      @apply transform-none transition-none;
    }
  }

  /* Print styles */
  @media print {
    .glossary-card {
      @apply break-inside-avoid shadow-none;
    }

    .arrow-icon {
      @apply transform-none;
    }
  }

  /* High contrast mode */
  @media (forced-colors: active) {
    .glossary-card {
      @apply border border-[CanvasText];
    }
  }
</style>
