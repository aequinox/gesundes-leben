---
/**
 * GroupSelector Component
 *
 * A navigation component that allows users to filter content by different
 * groups with visual indicators and smooth transitions.
 *
 * @component
 * @example
 * ```astro
 * <GroupSelector groupType="pro" />
 * ```
 */

import { Icon } from "astro-icon/components";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";

export type Identifier = "pro" | "contra" | "question-time";

interface Group {
  /** Unique identifier for the group */
  name: Identifier;
  /** Display title */
  title: string;
  /** Icon name from the icon set */
  icon: string;
  /** Navigation link */
  link: string;
  /** Group description */
  slogan: string;
  /** Position in layout (left, middle, right) */
  position?: string;
}

interface Props {
  /** The type of group to display */
  groupType: Identifier;
}

const { groupType }: Props = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Group configurations with type safety
const groups: Record<Identifier, Group> = {
  pro: {
    name: "pro",
    title: t("group.pro.title"),
    icon: "tabler:thumb-up",
    link: "/pro/",
    slogan: t("group.pro.slogan"),
    position: "left",
  },
  contra: {
    name: "contra",
    title: t("group.contra.title"),
    icon: "tabler:thumb-down",
    link: "/kontra/",
    slogan: t("group.contra.slogan"),
    position: "right",
  },
  "question-time": {
    name: "question-time",
    title: t("group.questionTime.title"),
    icon: "tabler:question-mark",
    link: "/fragezeiten/",
    slogan: t("group.questionTime.slogan"),
    position: "middle",
  },
} as const;

const { title, icon, slogan, position } = groups[groupType];

// Memoize translated strings
const ariaLabel = t("group.select").replace("{type}", title);

// Memoize common class names
const buttonClasses = [
  "group-selector group",
  "transition-all duration-500 ease-out",
  "hover:scale-[1.02]",
  position,
]
  .filter(Boolean)
  .join(" ");

const cardClasses = [
  "h-full rounded-xl p-8 text-center",
  "backdrop-blur-md backdrop-saturate-200",
  "border border-solid border-opacity-30",
  "transition duration-500 ease-out",
  `${groupType}-card`,
].join(" ");

const iconContainerClasses = [
  "group-type-icon",
  "transform transition-all duration-500",
  "group-hover:-translate-y-2 group-hover:scale-110",
  "md:block",
].join(" ");

const iconWrapperClasses = [
  "inline-flex items-center justify-center",
  "rounded-2xl border-2 border-solid",
  "bg-skin-fill/80 backdrop-blur-md",
  "p-4",
  `group-hover:border-${groupType}`,
  `border-${groupType}/40`,
  `icon-wrapper-${groupType}`,
].join(" ");

const titleClasses = [
  "text-skin mb-4 mt-2",
  "lg:text-4xl md:text-3xl text-5xl font-bold capitalize leading-tight",
  "tracking-tight",
  "transition-colors duration-300",
  `group-hover:text-${groupType}`,
].join(" ");

const sloganClasses = [
  "text-skin lg:text-lg leading-relaxed",
  "transition-colors duration-300",
  "opacity-95 group-hover:opacity-100",
].join(" ");
---

<button
  class={buttonClasses}
  id={`${groupType}-group`}
  aria-label={ariaLabel}
  type="button"
>
  <div class={cardClasses}>
    <div class={iconContainerClasses}>
      <div class={iconWrapperClasses}>
        <Icon
          name={icon}
          class:list={[
            "h-12 w-12 transition-transform duration-500",
            `${groupType}-icon`,
          ]}
          aria-hidden="true"
        />
      </div>
    </div>
    <div class="cursor-pointer">
      <h2 class={titleClasses}>
        {title}
      </h2>
      <p class={sloganClasses}>{slogan}</p>
    </div>
  </div>
</button>

<style>
  /* Icon styles */
  .group-type-icon {
    @apply -mt-20 mb-6 cursor-pointer leading-none;
    @apply transition-all duration-500;
  }

  /* Card styles with enhanced glass morphism for dark mode */
  .pro-card {
    @apply bg-gradient-to-br from-pro/20 via-pro/10 to-transparent;
    @apply dark:from-pro/30 dark:via-pro/15 dark:to-transparent/10;
    @apply shadow-[0_8px_32px_0_rgba(var(--color-pro-rgb),0.2)];
    @apply hover:shadow-[0_8px_40px_0_rgba(var(--color-pro-rgb),0.35)];
    @apply dark:shadow-[0_8px_32px_0_rgba(var(--color-pro-rgb),0.3)];
    @apply dark:hover:shadow-[0_8px_40px_0_rgba(var(--color-pro-rgb),0.45)];
  }

  .contra-card {
    @apply bg-gradient-to-br from-contra/20 via-contra/10 to-transparent;
    @apply dark:from-contra/30 dark:via-contra/15 dark:to-transparent/10;
    @apply shadow-[0_8px_32px_0_rgba(var(--color-contra-rgb),0.2)];
    @apply hover:shadow-[0_8px_40px_0_rgba(var(--color-contra-rgb),0.35)];
    @apply dark:shadow-[0_8px_32px_0_rgba(var(--color-contra-rgb),0.3)];
    @apply dark:hover:shadow-[0_8px_40px_0_rgba(var(--color-contra-rgb),0.45)];
  }

  .question-time-card {
    @apply bg-gradient-to-br from-question-time/20 via-question-time/10 to-transparent;
    @apply dark:from-question-time/30 dark:via-question-time/15 dark:to-transparent/10;
    @apply shadow-[0_8px_32px_0_rgba(var(--color-question-time-rgb),0.2)];
    @apply hover:shadow-[0_8px_40px_0_rgba(var(--color-question-time-rgb),0.35)];
    @apply dark:shadow-[0_8px_32px_0_rgba(var(--color-question-time-rgb),0.3)];
    @apply dark:hover:shadow-[0_8px_40px_0_rgba(var(--color-question-time-rgb),0.45)];
  }

  /* Icon colors with enhanced contrast and glow effects */
  .pro-icon {
    @apply text-pro drop-shadow-md;
    @apply dark:text-pro dark:drop-shadow-[0_0_8px_rgba(var(--color-pro-rgb),0.5)];
  }

  .contra-icon {
    @apply text-contra drop-shadow-md;
    @apply dark:text-contra dark:drop-shadow-[0_0_8px_rgba(var(--color-contra-rgb),0.5)];
  }

  .question-time-icon {
    @apply text-question-time drop-shadow-md;
    @apply dark:text-question-time dark:drop-shadow-[0_0_8px_rgba(var(--color-question-time-rgb),0.5)];
  }

  /* Icon wrapper glow effects for dark mode */
  .icon-wrapper-pro {
    @apply dark:shadow-[0_0_15px_rgba(var(--color-pro-rgb),0.2)];
    @apply dark:group-hover:shadow-[0_0_20px_rgba(var(--color-pro-rgb),0.3)];
  }

  .icon-wrapper-contra {
    @apply dark:shadow-[0_0_15px_rgba(var(--color-contra-rgb),0.2)];
    @apply dark:group-hover:shadow-[0_0_20px_rgba(var(--color-contra-rgb),0.3)];
  }

  .icon-wrapper-question-time {
    @apply dark:shadow-[0_0_15px_rgba(var(--color-question-time-rgb),0.2)];
    @apply dark:group-hover:shadow-[0_0_20px_rgba(var(--color-question-time-rgb),0.3)];
  }

  /* Position styles */
  .middle {
    @apply order-2 md:mx-4;
  }

  .left {
    @apply order-1 md:mr-4;
  }

  .right {
    @apply order-3 md:ml-4;
  }

  /* Focus styles */
  button:focus-visible {
    @apply outline-none ring-2 ring-skin-accent ring-offset-4;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .transition-all,
    .transition,
    .group-hover\:scale-110,
    .group-hover\:-translate-y-2 {
      @apply transform-none transition-none;
    }
  }

  /* High contrast mode */
  @media (forced-colors: active) {
    button {
      @apply border-2 border-[ButtonText];
    }
  }

  /* Print styles */
  @media print {
    button {
      @apply break-inside-avoid shadow-none;
    }
  }
</style>

<script>
  /**
   * Enhances group selector with keyboard navigation and filtering
   */
  function setupGroupSelector() {
    const buttons =
      document.querySelectorAll<HTMLButtonElement>(".group-selector");

    buttons.forEach(button => {
      button.addEventListener("click", () => {
        const blogGrid = document.getElementById("article-grid");
        if (!blogGrid) return;

        const groupType = button.id.replace("-group", "");
        const articleCards =
          blogGrid.querySelectorAll<HTMLElement>(".article-card");

        articleCards.forEach(card => {
          const shouldShow = card.dataset.group === groupType;
          card.classList.toggle("hide", !shouldShow);
          card.classList.toggle("show", shouldShow);

          // Update ARIA attributes
          card.setAttribute("aria-hidden", (!shouldShow).toString());
        });

        // Announce filter change to screen readers
        const announcement = document.createElement("div");
        announcement.setAttribute("role", "status");
        announcement.setAttribute("aria-live", "polite");
        announcement.className = "sr-only";
        announcement.textContent = `Showing ${groupType} content`;
        document.body.appendChild(announcement);
        setTimeout(() => announcement.remove(), 1000);
      });

      // Keyboard navigation
      button.addEventListener("keydown", (e: KeyboardEvent) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          button.click();
        }
      });
    });
  }

  // Initialize on page load
  setupGroupSelector();

  // Re-initialize after Astro page transitions
  document.addEventListener("astro:after-swap", setupGroupSelector);
</script>
