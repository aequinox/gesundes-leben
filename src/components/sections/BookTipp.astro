---
import { Picture } from "astro:assets";
import { Icon } from "astro-icon/components";
import Button from "@/components/elements/Button.astro";
import type { BookTippProps } from "@/types/books";

type Props = BookTippProps;

const {
  title,
  author,
  description,
  bookCover,
  isbn,
  url = "#",
  publishYear,
  rating = 4,
  class: className,
}: Props = Astro.props;

const ratingStars = Array.from({ length: 5 }, (_, i) => i < rating);
---

<article
  data-aos="fade-up"
  class:list={[
    "group relative isolate flex  transform flex-col overflow-hidden rounded-2xl bg-gradient-to-br from-skin-card/90 to-skin-card-muted/90 shadow-lg backdrop-blur-sm transition-all duration-500 ease-out-expo hover:scale-[1.02] hover:shadow-xl",
    className,
  ]}
>
  <!-- Decorative background elements -->
  <div
    class="absolute inset-0 -z-10 bg-gradient-to-br from-skin-accent/5 to-transparent"
    aria-hidden="true"
  >
  </div>
  <div
    class="absolute -left-32 top-1/2 h-64 w-64 -translate-y-1/2 transform rounded-full bg-skin-accent/5 blur-3xl"
    aria-hidden="true"
  >
  </div>

  <!-- Affiliate Badge -->
  <div
    class="absolute right-4 top-4 z-10 flex items-center gap-1.5 rounded-full bg-skin-accent/90 px-3 py-1.5 text-xs font-medium text-skin-inverted backdrop-blur-sm"
  >
    <Icon name="tabler:info-circle" class="h-4 w-4" />
    <span>Affiliate</span>
  </div>

  <div class="flex h-full flex-col md:flex-row">
    <!-- Book Cover Container -->
    <div
      class="relative h-[300px] overflow-hidden bg-gradient-to-br from-skin-accent/5 to-skin-accent/10 md:h-full md:w-1/3"
    >
      {
        bookCover ? (
          <Picture
            src={bookCover}
            formats={["avif", "webp"]}
            alt={`Cover des Buches "${title}" von ${author}`}
            class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
            widths={[400, 800]}
            sizes="(max-width: 768px) 100vw, 33vw"
          />
        ) : (
          <div class="flex h-full w-full items-center justify-center bg-gradient-to-br from-skin-accent/5 to-skin-accent/10">
            <Icon
              name="tabler:book"
              class="h-32 w-32 text-skin-accent/40 transition-transform duration-500 ease-out-expo group-hover:scale-110"
            />
          </div>
        )
      }

      <!-- Gradient overlay for mobile -->
      <div
        class="absolute inset-0 bg-gradient-to-t from-skin-card/90 to-transparent md:hidden"
        aria-hidden="true"
      >
      </div>
    </div>

    <!-- Book Details -->
    <div class="flex flex-1 flex-col p-6 md:p-8">
      <div class="flex-1 space-y-6">
        <!-- Header -->
        <div class="space-y-3">
          <div class="flex items-center gap-3">
            <div
              class="text-sm font-semibold uppercase tracking-wider text-skin-accent"
            >
              Buchtipp
            </div>
            {
              publishYear && (
                <span class="rounded-full bg-skin-accent/10 px-3 py-1 text-xs font-medium text-skin-accent">
                  {publishYear}
                </span>
              )
            }
          </div>

          <h2
            class="relative text-xl font-bold leading-tight text-skin-base transition-colors duration-300 md:text-2xl"
          >
            {title}
          </h2>

          <!-- Rating Stars -->
          <div
            class="flex items-center gap-1"
            aria-label={`${rating} von 5 Sternen`}
          >
            {
              ratingStars.map(filled => (
                <Icon
                  name={filled ? "tabler:star-filled" : "tabler:star"}
                  class={`h-5 w-5 ${
                    filled ? "text-amber-400" : "text-skin-base/30"
                  }`}
                />
              ))
            }
          </div>
        </div>

        <!-- Description -->
        <p class="line-clamp-4 text-base leading-relaxed text-skin-base/80">
          {description}
        </p>
      </div>

      <!-- Footer -->
      <div
        class="mt-6 flex flex-wrap items-center gap-6 border-t border-skin-line/30 pt-6"
      >
        <div class="flex items-center gap-2">
          <Icon name="tabler:user" class="h-5 w-5 text-skin-accent/60" />
          <span class="text-sm font-medium text-skin-base/75">{author}</span>
        </div>
        {
          isbn && (
            <div class="flex items-center gap-2">
              <Icon name="tabler:barcode" class="h-5 w-5 text-skin-accent/60" />
              <span class="text-sm font-medium text-skin-base/75">
                ISBN: {isbn}
              </span>
            </div>
          )
        }
        <Button
          type="button"
          variant="accented"
          icon="tabler:external-link"
          href={url}
          target="_blank"
          rel="noopener noreferrer"
          class="ml-auto"
          text="Mehr erfahren"
        />
      </div>
    </div>
  </div>
</article>

<style>
  .ease-out-expo {
    transition-timing-function: cubic-bezier(0.19, 1, 0.22, 1);
  }

  /* Enhance focus styles for better accessibility */
  article:focus-within {
    @apply ring-2 ring-skin-accent ring-offset-2 ring-offset-skin-base;
  }
</style>
