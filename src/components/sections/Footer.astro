---
/**
 * Footer Component
 *
 * A responsive footer component that displays copyright information,
 * social links, and optional content. Supports internationalization
 * and maintains accessibility standards.
 *
 * @component
 * @example
 * ```astro
 * <Footer noMarginTop={false} />
 * ```
 */

import Hr from "@/components/elements/Hr.astro";
import Socials from "@/components/sections/Socials.astro";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { SITE } from "@/config";
import { authorService } from "@/services/content/AuthorService";

// Get the author display name using the enhanced service
const authorDisplayName = await authorService.getAuthorDisplayName(SITE.author);

interface Props {
  /** Whether to remove the top margin */
  noMarginTop?: boolean;
}

const { noMarginTop = false }: Props = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const currentYear = new Date().getFullYear();

// Memoize common class names
const containerClasses = ["w-full", noMarginTop ? "" : "mt-auto"]
  .filter(Boolean)
  .join(" ");
---

<footer class={containerClasses} data-aos="fade-up" data-aos-duration="800">
  <Hr variant="gradient" noPadding />

  <div class="footer-container">
    <div class="footer-content">
      <div class="footer-section brand-section">
        <div class="copyright-wrapper">
          <span class="copyright-text">
            {t("footer.copyright")} &#169; {currentYear}
            {SITE.author && ` ${authorDisplayName}`}
          </span>
          <span class="rights-text">{t("footer.rights")}</span>
        </div>
      </div>

      <div class="footer-section links-section">
        <div class="footer-links">
          <a href="/imprint" class="footer-link">
            <span class="link-text">{t("footer.imprint")}</span>
            <span class="link-hover-effect"></span>
          </a>
        </div>
      </div>

      <div class="footer-section social-section">
        <Socials centered />
      </div>
    </div>
  </div>
</footer>

<style>
  /* Base styles */
  footer {
    @apply relative transition-all duration-300;
    margin-top: 4rem;
  }

  .footer-container {
    @apply relative overflow-hidden rounded-t-2xl px-6 py-8;
    background: linear-gradient(
      to bottom,
      rgba(var(--color-card-rgb), 0.5),
      rgba(var(--color-card-rgb), 0.8)
    );
    backdrop-filter: blur(12px);
    border-top: 1px solid rgba(var(--color-accent-rgb), 0.1);
    box-shadow: 0 -10px 30px -15px rgba(0, 0, 0, 0.1);
  }

  .footer-content {
    @apply mx-auto grid max-w-content gap-8;
    grid-template-columns: 1fr;
  }

  /* Footer sections */
  .footer-section {
    @apply flex flex-col items-center justify-center;
    transition: transform 0.3s ease;
  }

  .footer-section:hover {
    transform: translateY(-2px);
  }

  /* Brand section */
  .brand-section {
    @apply text-center;
  }

  .copyright-wrapper {
    @apply flex flex-col items-center gap-1;
  }

  .copyright-text,
  .rights-text {
    @apply text-sm opacity-80;
  }

  /* Links section */
  .links-section {
    @apply my-4;
  }

  .footer-links {
    @apply flex flex-wrap justify-center gap-6;
  }

  .footer-link {
    @apply relative inline-block px-4 py-2 font-medium text-skin-base transition-all duration-300;
  }

  .link-text {
    @apply relative z-10;
  }

  .link-hover-effect {
    @apply absolute bottom-0 left-0 h-[2px] w-0 rounded-full bg-skin-accent transition-all duration-300;
  }

  .footer-link:hover {
    @apply text-skin-accent;
  }

  .footer-link:hover .link-hover-effect {
    @apply w-full;
  }

  .footer-link:focus-visible {
    @apply outline-none ring-2 ring-skin-accent ring-offset-2;
  }

  /* Social section */
  .social-section {
    @apply mt-2;
  }

  /* Responsive layout */
  @media (min-width: 768px) {
    .footer-content {
      grid-template-columns: 1fr 1fr 1fr;
      @apply items-center;
    }

    .copyright-wrapper {
      @apply items-start;
    }

    .social-section {
      @apply mt-0;
    }
  }

  /* Dark mode adjustments */
  :global(html[data-theme="dark"]) .footer-container {
    background: linear-gradient(
      to bottom,
      rgba(var(--color-card-rgb), 0.3),
      rgba(var(--color-card-rgb), 0.5)
    );
    border-top: 1px solid rgba(var(--color-accent-rgb), 0.05);
    box-shadow: 0 -10px 30px -15px rgba(0, 0, 0, 0.2);
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    footer,
    .footer-section,
    .footer-link,
    .link-hover-effect {
      @apply transition-none;
    }

    .footer-section:hover {
      transform: none;
    }
  }

  /* Print styles */
  @media print {
    footer {
      @apply hidden;
    }
  }

  /* High contrast mode */
  @media (forced-colors: active) {
    .footer-container {
      @apply border-t border-[CanvasText];
      background: Canvas;
      backdrop-filter: none;
    }

    .link-hover-effect {
      @apply bg-[Highlight];
    }
  }
</style>

<script>
  /**
   * Enhances footer links with keyboard navigation and animations
   */
  function setupFooter() {
    const footerLinks = document.querySelectorAll<HTMLElement>(".footer-link");
    const footerSections =
      document.querySelectorAll<HTMLElement>(".footer-section");

    // Handle keyboard navigation
    const handleKeydown = (event: Event) => {
      const e = event as KeyboardEvent;
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        (e.currentTarget as HTMLElement).click();
      }
    };

    footerLinks.forEach(link => {
      link.addEventListener("keydown", handleKeydown);
    });

    // Add staggered animation to footer sections
    if ("IntersectionObserver" in window) {
      const observer = new IntersectionObserver(
        entries => {
          entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
              setTimeout(() => {
                entry.target.classList.add("animate-in");
              }, index * 100);
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.1 }
      );

      footerSections.forEach(section => {
        observer.observe(section);
      });
    }

    // Cleanup function to prevent memory leaks
    return () => {
      footerLinks.forEach(link => {
        link.removeEventListener("keydown", handleKeydown);
      });
    };
  }

  // Initialize on page load
  let cleanup = setupFooter();

  // Re-initialize after Astro page transitions
  document.addEventListener("astro:after-swap", () => {
    if (cleanup) cleanup();
    cleanup = setupFooter();
  });

  // Cleanup on page unload
  document.addEventListener("astro:before-swap", () => {
    if (cleanup) cleanup();
  });
</script>
