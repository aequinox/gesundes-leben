---
/**
 * Footer Component
 *
 * A responsive footer component that displays copyright information,
 * social links, and optional content. Supports internationalization
 * and maintains accessibility standards.
 *
 * @component
 * @example
 * ```astro
 * <Footer noMarginTop={false} />
 * ```
 */

import Hr from "@/components/elements/Hr.astro";
import Socials from "@/components/sections/Socials.astro";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { SITE } from "@/config";

interface Props {
  /** Whether to remove the top margin */
  noMarginTop?: boolean;
}

const { noMarginTop = false }: Props = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const currentYear = new Date().getFullYear();

// Memoize common class names
const containerClasses = ["w-full", noMarginTop ? "" : "mt-auto"]
  .filter(Boolean)
  .join(" ");

const footerClasses = [
  "footer-wrapper",
  "flex flex-col items-center justify-between py-6",
  "sm:flex-row-reverse sm:py-4",
].join(" ");

const copyrightClasses = [
  "copyright-wrapper",
  "my-2 flex flex-col items-center whitespace-nowrap",
  "sm:flex-row",
].join(" ");
---

<footer class={containerClasses}>
  <Hr noPadding />
  <div class={footerClasses}>
    <Socials centered />
    <div class={copyrightClasses}>
      <span>
        {t("footer.copyright")} &#169; {currentYear}
        {SITE.author && ` ${SITE.author}`}
      </span>
      <span class="hidden sm:inline">&nbsp;|&nbsp;</span>
      <span>{t("footer.rights")}</span>
    </div>
  </div>
</footer>

<style>
  /* Base styles */
  footer {
    @apply transition-colors duration-300;
  }

  /* Focus styles */
  footer:focus-within {
    @apply ring-2 ring-skin-accent ring-offset-2;
  }

  /* Link styles */
  .link-button {
    @apply my-1 p-2 transition-transform duration-200 hover:rotate-6;
  }

  .link-button :global(svg) {
    @apply scale-125;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    footer,
    .link-button {
      @apply transition-none;
    }

    .link-button:hover {
      @apply rotate-0;
    }
  }

  /* Print styles */
  @media print {
    footer {
      @apply hidden;
    }
  }

  /* Dark mode adjustments */
  :global(.dark) footer {
    @apply bg-skin-fill/5;
  }

  /* High contrast mode */
  @media (forced-colors: active) {
    footer {
      @apply border-t border-[CanvasText];
    }
  }
</style>

<script>
  /**
   * Enhances footer links with keyboard navigation
   */
  function setupFooter() {
    const links = document.querySelectorAll<HTMLElement>(".link-button");

    const handleKeydown = (event: Event) => {
      const e = event as KeyboardEvent;
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        (e.currentTarget as HTMLElement).click();
      }
    };

    links.forEach(link => {
      link.addEventListener("keydown", handleKeydown);
    });

    // Cleanup function to prevent memory leaks
    return () => {
      links.forEach(link => {
        link.removeEventListener("keydown", handleKeydown);
      });
    };
  }

  // Initialize on page load
  let cleanup = setupFooter();

  // Re-initialize after Astro page transitions
  document.addEventListener("astro:after-swap", () => {
    cleanup();
    cleanup = setupFooter();
  });

  // Cleanup on page unload
  document.addEventListener("astro:before-swap", () => {
    cleanup();
  });
</script>
