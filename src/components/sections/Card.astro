---
import { Picture } from "astro:assets";
import { type CollectionEntry } from "astro:content";
import ArticleMeta from "../partials/ArticleMeta.astro";
import { slugifyStr } from "@/utils/slugify";

export interface Props {
  post: CollectionEntry<"blog">;
  secHeading?: boolean;
  withHeroImage?: boolean;
  loading?: "eager" | "lazy";
}
const { post, withHeroImage = true, loading = "eager" }: Props = Astro.props;

const {
  slug,
  data: { title, heroImage, description, categories, group: groupProp },
} = post;
const href = `/posts/${slug}/`;

// const headerProps = {
//   style: { viewTransitionName: `${href}-title` },
//   className: "text-lg font-medium",
// };

const group =
  groupProp === "fragezeiten"
    ? "question-time"
    : groupProp === "kontra"
      ? "contra"
      : "pro";

// const headerProps = {
//   style: { viewTransitionName: href },
//   className: 'text-lg font-medium decoration-dashed hover:underline',
// };
---

<article
  class="article-card hover:shadow-skin-accent/000 flex flex-col justify-between overflow-hidden rounded-sm bg-skin-card/10 hover:bg-skin-card/30 hover:shadow-lg"
  data-categories={categories?.join("|")}
  data-group={group}
  aria-label={title}
>
  <header class="w-full group-hover:opacity-80">
    {
      withHeroImage && heroImage && (
        <div class="group relative cursor-pointer overflow-hidden">
          <a href={href}>
            <Picture
              src={heroImage.src}
              format={"avif"}
              widths={[400, 800]}
              sizes="(max-width: 800px) 400px, (max-width: 1200px) 800px"
              alt={title}
              loading={loading}
              class="aspect-video w-full object-cover transition-all delay-500 duration-300 ease-in-out group-hover:scale-105 group-hover:grayscale-[25%]"
              transition:name={slugifyStr(title + "-heroImage")}
            />
          </a>
          <div class="absolute bottom-2 right-2 rounded-full bg-skin-accent/70 px-2 py-[0.5rem] text-skin-fill transition-all delay-100 duration-300 ease-in-out group-hover:scale-105 group-hover:bg-skin-accent">
            {group && group === "pro" ? (
              <svg xmlns="http://www.w3.org/2000/svg" class="mb-1 h-6 w-6">
                <path
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 11v8a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-7a1 1 0 0 1 1-1za4 4 0 0 0 4-4V6a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1-2 2h-7a3 3 0 0 1-3-3"
                />
              </svg>
            ) : group && group === "contra" ? (
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6">
                <path
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 13V5a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1za4 4 0 0 1 4 4v1a2 2 0 0 0 4 0v-5h3a2 2 0 0 0 2-2l-1-5a2 3 0 0 0-2-2h-7a3 3 0 0 0-3 3"
                />
              </svg>
            ) : (
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6">
                <path
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 8a3.5 3 0 0 1 3.5-3h1A3.5 3 0 0 1 16 8a3 3 0 0 1-2 3a3 4 0 0 0-2 4m0 4v.01"
                />
              </svg>
            )}
          </div>
        </div>
      )
    }

    <div class="p-4">
      <div class="mb-4">
        <div class="mb-2 flex flex-wrap text-xs uppercase">
          {
            categories &&
              categories.map((category: string) => (
                <div
                  transition:name={slugifyStr(title + category)}
                  class="mb-1 mr-[0.125rem] inline-flex items-center text-sm font-medium text-skin-accent after:[&:not(:last-child)]:ml-[0.125rem] after:[&:not(:last-child)]:content-['|']"
                >
                  {category}
                </div>
              ))
          }
        </div>
        <h2 class="text-lg font-medium" transition:name={slugifyStr(title)}>
          {title}
        </h2>

        <ArticleMeta {post} />

        <div class="line-clamp-3">
          {description}
        </div>
      </div>
    </div>
  </header>

  <div class="group mt-auto pb-4 pl-4">
    <a
      href={href}
      class="mr-2 mt-4 text-sm font-bold uppercase group-hover:text-skin-accent"
    >
      Weiterlesen
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="transition-transform duration-300 group-hover:scale-110 group-hover:text-skin-accent"
      >
        <path
          fill="currentColor"
          d="M12 15.289L15.288 12L12 8.711l-.688.689l2.1 2.1H8.5v1h4.912l-2.1 2.1zM12.003 21q-1.867 0-3.51-.708q-1.643-.709-2.859-1.924t-1.925-2.856T3 12.003t.709-3.51Q4.417 6.85 5.63 5.634t2.857-1.925T11.997 3t3.51.709q1.643.708 2.859 1.922t1.925 2.857t.709 3.509t-.708 3.51t-1.924 2.859t-2.856 1.925t-3.509.709M12 20q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"
        ></path>
      </svg>
    </a>
  </div>
</article>

<style lang="css">
  @keyframes hide {
    from {
      display: block;
      opacity: 1;
      scale: 1;
    }
    to {
      opacity: 0;
      scale: 0;
    }
  }
  @keyframes show {
    from {
      opacity: 0;
      scale: 0;
    }
    to {
      display: block;
      opacity: 1;
      scale: 1;
    }
  }

  .hide {
    display: none;
    animation: hide 100ms ease-in-out;
  }
  .show {
    display: block;
    animation: show 400ms ease-in-out;
  }
</style>
