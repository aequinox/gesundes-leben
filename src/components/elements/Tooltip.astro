---
export interface Props {
  /** Tooltip text content */
  text: string;
  /** Tooltip position */
  position?: "top" | "right" | "bottom" | "left";
  /** Visual style variant */
  variant?: "default" | "dark" | "light" | "accent";
  /** Whether to show an arrow */
  arrow?: boolean;
  /** Delay before showing (ms) */
  delay?: number;
  /** Additional CSS classes */
  class?: string;
}

const {
  text,
  position = "top",
  variant = "default",
  arrow = true,
  delay = 300,
  class: className = "",
} = Astro.props;

const positionClasses = {
  top: "tooltip-top",
  right: "tooltip-right",
  bottom: "tooltip-bottom",
  left: "tooltip-left",
};

const variantClasses = {
  default: "tooltip-default",
  dark: "tooltip-dark",
  light: "tooltip-light",
  accent: "tooltip-accent",
};

const arrowClass = arrow ? "tooltip-arrow" : "";
---

<div
  class:list={[
    "tooltip-container",
    positionClasses[position],
    variantClasses[variant],
    arrowClass,
    className,
  ]}
  data-tooltip={text}
  data-tooltip-delay={delay}
>
  <slot />
</div>

<style>
  .tooltip-container {
    @apply relative inline-flex cursor-pointer;
  }

  .tooltip-container::before,
  .tooltip-container::after {
    @apply absolute z-50 hidden whitespace-nowrap opacity-0 transition-all duration-200;
    content: attr(data-tooltip);
    pointer-events: none;
  }

  .tooltip-container::before {
    @apply rounded-md px-3 py-1.5 text-xs font-medium;
  }

  .tooltip-container::after {
    @apply h-0 w-0;
    content: "";
  }

  /* Position variants */
  .tooltip-top::before {
    @apply -translate-x-1/2 -translate-y-full;
    bottom: 100%;
    left: 50%;
    margin-bottom: 8px;
  }

  .tooltip-top.tooltip-arrow::after {
    @apply -translate-x-1/2;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    bottom: 100%;
    left: 50%;
    margin-bottom: 2px;
  }

  .tooltip-right::before {
    @apply translate-x-2 -translate-y-1/2;
    left: 100%;
    top: 50%;
  }

  .tooltip-right.tooltip-arrow::after {
    @apply -translate-y-1/2;
    border-bottom: 6px solid transparent;
    border-top: 6px solid transparent;
    left: 100%;
    margin-left: -4px;
    top: 50%;
  }

  .tooltip-bottom::before {
    @apply -translate-x-1/2 translate-y-full;
    left: 50%;
    top: 100%;
    margin-top: 8px;
  }

  .tooltip-bottom.tooltip-arrow::after {
    @apply -translate-x-1/2;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    left: 50%;
    top: 100%;
    margin-top: 2px;
  }

  .tooltip-left::before {
    @apply -translate-x-full -translate-y-1/2;
    right: 100%;
    top: 50%;
    margin-right: 8px;
  }

  .tooltip-left.tooltip-arrow::after {
    @apply -translate-y-1/2;
    border-bottom: 6px solid transparent;
    border-top: 6px solid transparent;
    right: 100%;
    margin-right: -4px;
    top: 50%;
  }

  /* Style variants */
  .tooltip-default::before {
    @apply bg-skin-card text-skin-base shadow-md;
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .tooltip-default.tooltip-arrow::after {
    border-top-color: oklch(var(--color-card));
  }

  .tooltip-default.tooltip-bottom.tooltip-arrow::after {
    border-bottom-color: oklch(var(--color-card));
    border-top-color: transparent;
  }

  .tooltip-default.tooltip-right.tooltip-arrow::after {
    border-right-color: oklch(var(--color-card));
    border-top-color: transparent;
  }

  .tooltip-default.tooltip-left.tooltip-arrow::after {
    border-left-color: oklch(var(--color-card));
    border-top-color: transparent;
  }

  .tooltip-dark::before {
    @apply bg-skin-inverted text-skin-inverted shadow-md;
  }

  .tooltip-dark.tooltip-arrow::after {
    border-top-color: oklch(var(--color-text-base));
  }

  .tooltip-dark.tooltip-bottom.tooltip-arrow::after {
    border-bottom-color: oklch(var(--color-text-base));
    border-top-color: transparent;
  }

  .tooltip-dark.tooltip-right.tooltip-arrow::after {
    border-right-color: oklch(var(--color-text-base));
    border-top-color: transparent;
  }

  .tooltip-dark.tooltip-left.tooltip-arrow::after {
    border-left-color: oklch(var(--color-text-base));
    border-top-color: transparent;
  }

  .tooltip-light::before {
    @apply bg-white text-gray-800 shadow-md;
    box-shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1),
      0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .tooltip-light.tooltip-arrow::after {
    border-top-color: white;
  }

  .tooltip-light.tooltip-bottom.tooltip-arrow::after {
    border-bottom-color: white;
    border-top-color: transparent;
  }

  .tooltip-light.tooltip-right.tooltip-arrow::after {
    border-right-color: white;
    border-top-color: transparent;
  }

  .tooltip-light.tooltip-left.tooltip-arrow::after {
    border-left-color: white;
    border-top-color: transparent;
  }

  .tooltip-accent::before {
    @apply bg-skin-accent text-skin-inverted shadow-md;
  }

  .tooltip-accent.tooltip-arrow::after {
    border-top-color: oklch(var(--color-accent));
  }

  .tooltip-accent.tooltip-bottom.tooltip-arrow::after {
    border-bottom-color: oklch(var(--color-accent));
    border-top-color: transparent;
  }

  .tooltip-accent.tooltip-right.tooltip-arrow::after {
    border-right-color: oklch(var(--color-accent));
    border-top-color: transparent;
  }

  .tooltip-accent.tooltip-left.tooltip-arrow::after {
    border-left-color: oklch(var(--color-accent));
    border-top-color: transparent;
  }

  /* Hover state */
  .tooltip-container:hover::before,
  .tooltip-container:hover::after {
    @apply block opacity-100;
  }

  /* Dark mode adjustments */
  :global(html[data-theme="dark"]) .tooltip-light::before {
    @apply bg-gray-800 text-gray-100;
  }

  :global(html[data-theme="dark"]) .tooltip-light.tooltip-arrow::after {
    border-top-color: #1f2937;
  }

  :global(html[data-theme="dark"])
    .tooltip-light.tooltip-bottom.tooltip-arrow::after {
    border-bottom-color: #1f2937;
    border-top-color: transparent;
  }

  :global(html[data-theme="dark"])
    .tooltip-light.tooltip-right.tooltip-arrow::after {
    border-right-color: #1f2937;
    border-top-color: transparent;
  }

  :global(html[data-theme="dark"])
    .tooltip-light.tooltip-left.tooltip-arrow::after {
    border-left-color: #1f2937;
    border-top-color: transparent;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tooltips = document.querySelectorAll(".tooltip-container");

    tooltips.forEach(tooltip => {
      if (tooltip instanceof HTMLElement) {
        const delay = parseInt(tooltip.dataset.tooltipDelay || "300", 10);
        let timer: number;

        tooltip.addEventListener("mouseenter", () => {
          timer = window.setTimeout(() => {
            tooltip.classList.add("tooltip-visible");
          }, delay);
        });

        tooltip.addEventListener("mouseleave", () => {
          clearTimeout(timer);
          tooltip.classList.remove("tooltip-visible");
        });
      }
    });
  });
</script>
