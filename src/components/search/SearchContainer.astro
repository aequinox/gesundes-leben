---
/**
 * SearchContainer Component
 *
 * Container for the Pagefind search interface.
 * Handles the search UI and accessibility announcements.
 */

import { SITE } from "@/config";

const backUrl = SITE.showBackButton ? `${Astro.url.pathname}` : "/";
---

<!-- Search container -->
<div
  id="pagefind-search"
  transition:persist
  data-backurl={backUrl}
  role="search"
  aria-label="Artikel-Suche"
  style="display: none;"
>
</div>

<!-- Accessibility announcements -->
<div
  id="search-announcements"
  aria-live="polite"
  aria-atomic="true"
  class="sr-only"
>
</div>

<style is:global>
  /* Base styles */
  @reference "@/styles/global.css";

  /* Search container styles */
  #pagefind-search {
    --pagefind-ui-scale: 0.95;
    --pagefind-ui-font: var(--font-popplers);
    --pagefind-ui-text: var(--foreground);
    --pagefind-ui-background: var(--background);
    --pagefind-ui-border: var(--border);
    --pagefind-ui-primary: var(--accent);
    --pagefind-ui-tag: var(--background);
    --pagefind-ui-border-radius: 0.375rem;
    --pagefind-ui-border-width: 1px;
    --pagefind-ui-image-border-radius: 8px;
    --pagefind-ui-image-box-ratio: 3 / 2;

    transition: opacity 0.3s ease-in-out;

    form::before {
      background-color: var(--foreground);
    }

    input {
      font-weight: 400;
      border: 1px solid var(--border);
      transition:
        border-color 0.2s ease,
        box-shadow 0.2s ease;
    }

    input:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px hsl(var(--accent) / 0.1);
    }

    .pagefind-ui__result-title a {
      color: var(--accent);
      outline-offset: 2px;
      outline-color: var(--accent);
      transition: color 0.2s ease;
    }

    .pagefind-ui__result-title a:hover {
      color: hsl(var(--accent) / 0.8);
    }

    .pagefind-ui__result-title a:focus-visible,
    .pagefind-ui__search-clear:focus-visible {
      text-decoration-line: none;
      outline-width: 2px;
      outline-style: solid;
      outline-offset: 2px;
    }

    .pagefind-ui__result:last-of-type {
      border-bottom: 0;
    }

    .pagefind-ui__result-nested .pagefind-ui__result-link:before {
      font-family: system-ui;
    }

    /* Enhanced mobile responsiveness */
    @media (max-width: 768px) {
      --pagefind-ui-scale: 1;

      .pagefind-ui__search-input {
        font-size: 16px; /* Prevent zoom on iOS */
        padding: 12px 16px;
      }

      .pagefind-ui__result {
        padding: 16px 12px;
      }
    }
  }

  .pagefind-ui__result-excerpt mark {
    @apply bg-accent text-foreground;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
  }

  /* Accessibility improvements */
  @media (prefers-reduced-motion: reduce) {
    #pagefind-search,
    #pagefind-search input {
      transition: none;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    #pagefind-search input:focus-visible {
      outline-width: 3px;
      outline-style: solid;
    }

    .pagefind-ui__result-excerpt mark {
      outline: 2px solid;
    }
  }

  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>
