---
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import { Icon } from "astro-icon/components";
import type { CollectionEntry } from "astro:content";
import { authorService } from "@/services/content/AuthorService";

/**
 * Component props interface with strict typing
 */
interface Props {
  /** The author reference (string ID or reference object) */
  author: string | { collection: "authors"; id: string };
  /** Size variant for the component */
  size?: "sm" | "lg";
  /** Additional CSS classes */
  classes?: string;
}

const { author, size = "sm", classes = "" }: Props = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Get author entry from service
const authorEntry = await authorService.getAuthorEntry(author);

// Precompute classes for better performance
const iconClasses = [
  "inline-block",
  "fill-skin-base",
  size === "sm" ? "h-5 w-5" : "scale-100",
];

const textClasses = ["italic", size === "sm" ? "text-sm" : "text-base"];
---

{
  authorEntry && (
    <div
      class:list={[
        "flex items-center gap-1 opacity-80 transition-opacity hover:opacity-100",
        classes.trim(),
      ]}
    >
      <Icon
        name="tabler:user"
        class:list={iconClasses}
        aria-hidden="true"
        role="presentation"
      />
      <span class:list={textClasses}>
        <span data-pagefind-ignore class="sr-only">
          {t("author.from")}
        </span>
        <a
          href={`/author/${authorEntry.slug}`}
          class="rounded-sm hover:underline focus:outline-none focus:ring-2 focus:ring-skin-accent focus:ring-offset-2"
        >
          <span data-pagefind-filter={t("author.name")}>
            {authorEntry.data.name}
          </span>
        </a>
      </span>
    </div>
  )
}
