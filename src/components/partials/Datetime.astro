---
import { Icon } from "astro-icon/components";
import { formattedDateTime } from "@/utils/getFormattedDate";
import { getLangFromUrl, useTranslations } from "@/i18n/utils";
import type { DateTimeInput } from "@/types/datetime";

/**
 * Component props interface with strict typing
 */
interface Props extends DateTimeInput {
  /** Size variant for the component */
  size?: "sm" | "lg";
  /** Additional CSS classes */
  classes?: string;
}

const {
  pubDatetime,
  modDatetime,
  size = "sm",
  classes = "",
}: Props = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const { dt, date, time } = formattedDateTime({ pubDatetime, modDatetime });
const isUpdated = modDatetime ? modDatetime > pubDatetime : false;
const iconName = `tabler:calendar-${isUpdated ? "time" : "month"}`;

// Precompute classes for better performance
const iconClasses = [
  "inline-block",
  "fill-skin-base",
  size === "sm" ? "scale-90" : "scale-100",
  "h-6",
  "w-6",
  "min-w-[1.5rem]",
];

const textClasses = ["italic", size === "sm" ? "text-sm" : "text-base"];

// Use language-specific aria labels
const ariaLabel =
  lang === "de"
    ? isUpdated
      ? "Aktualisiert am"
      : "Ver√∂ffentlicht am"
    : isUpdated
      ? "Updated on"
      : "Published on";
---

<div
  class:list={[
    "flex items-center gap-2 opacity-80 transition-opacity hover:opacity-100",
    classes.trim(),
  ]}
  aria-label={ariaLabel}
>
  <Icon
    name={iconName}
    class:list={iconClasses}
    aria-hidden="true"
    role="presentation"
  />

  <span class:list={textClasses}>
    <time datetime={dt.toISOString()} title={dt.toLocaleString(lang)}>
      {date}
    </time>
    <span aria-hidden="true" class="select-none">
      {" "}
      |{" "}
    </span>
    <span class="sr-only">{t("datetime.at")}</span>
    <span class="text-nowrap">{time}</span>
  </span>
</div>
