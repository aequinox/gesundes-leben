---
/**
 * Homepage Component (2025 Edition)
 *
 * The main landing page for the Gesundes Leben blog.
 * Features a modern hero section, dynamic blog filter, and enhanced content presentation.
 */

import Layout from "@/layouts/Layout.astro";
import Header from "@/components/sections/Header.astro";
import Footer from "@/components/sections/Footer.astro";
import { SITE } from "@/config";
import Hr from "@/components/elements/Hr.astro";
import BlogFilter from "@/components/filter/BlogFilter.astro";
import Card from "@/components/sections/Card.astro";
import LinkButton from "@/components/elements/LinkButton.astro";
import HeroSection from "@/components/sections/HeroSection.astro";
import { postService } from "@/services/content/PostService";
import { Icon } from "astro-icon/components";

// Fetch and process posts using the PostService
const posts = await postService.getAllPosts();
const sortedPosts = await postService.getSortedPosts(posts);

// Get featured and recent posts using the PostService
const featuredPosts = await postService.getFeaturedPosts(sortedPosts);
const recentPosts = await postService.getRecentPosts(sortedPosts);
---

<Layout>
  <Header />
  <main id="main-content" class="relative overflow-hidden">
    {/* Background decorative elements */}
    <div
      class="absolute -top-24 -right-24 h-64 w-64 rounded-full bg-skin-accent/5 blur-3xl"
    >
    </div>
    <div
      class="absolute top-1/3 -left-32 h-96 w-96 rounded-full bg-skin-accent/5 blur-3xl"
    >
    </div>

    {/* Hero Section with enhanced styling */}
    <div class="relative z-10">
      <HeroSection />
    </div>

    <Hr />

    {/* Blog Filter Section */}
    <div class="relative z-10 backdrop-blur-sm">
      <BlogFilter />
    </div>

    {/* Featured Articles Section */}
    {
      featuredPosts.length > 0 && (
        <section
          id="featured"
          class="relative z-10"
          data-aos="fade-up"
          data-aos-duration="800"
        >
          <div class="flex items-center gap-3">
            <Icon name="tabler:star" class="h-7 w-7 text-skin-accent" />
            <h2 class="text-3xl font-bold tracking-tight">
              Ausgew√§hlte Artikel
            </h2>
          </div>

          <div class="mt-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-2">
            {featuredPosts.map((post, index) => (
              <div
                data-aos="fade-up"
                data-aos-delay={index * 100}
                class="transform transition-all duration-300 hover:translate-y-[-4px]"
              >
                <Card post={post} loading="lazy" />
              </div>
            ))}
          </div>
        </section>
      )
    }

    {/* Recent Articles Section */}
    {
      recentPosts.length > 0 && (
        <>
          <Hr />
          <section
            id="recent-posts"
            class="relative z-10"
            data-aos="fade-up"
            data-aos-duration="800"
          >
            <div class="flex items-center gap-3">
              <Icon name="tabler:clock" class="h-7 w-7 text-skin-accent" />
              <h2 class="text-3xl font-bold tracking-tight">Neueste Artikel</h2>
            </div>

            <div class="mt-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
              {recentPosts.map(
                (post, index) =>
                  index < SITE.postPerIndex && (
                    <div
                      data-aos="fade-up"
                      data-aos-delay={index * 100}
                      class="transform transition-all duration-300 hover:translate-y-[-4px]"
                    >
                      <Card post={post} loading="lazy" />
                    </div>
                  )
              )}
            </div>
          </section>
        </>
      )
    }

    <Hr />

    {/* All Posts Button */}
    <div
      class="all-posts-btn-wrapper"
      data-aos="fade-up"
      data-aos-duration="600"
    >
      <LinkButton
        href="/posts/"
        className="group relative overflow-hidden rounded-lg bg-skin-accent px-6 py-3 font-medium text-skin-inverted shadow-md transition-all duration-300 hover:shadow-lg"
      >
        <span class="relative z-10 flex items-center gap-2">
          Alle Artikel
          <Icon
            name="tabler:arrow-right"
            class="h-5 w-5 transform transition-transform duration-300 group-hover:translate-x-1"
          />
        </span>
        <span
          class="absolute inset-0 -z-10 bg-gradient-to-r from-skin-accent to-skin-accent/80 opacity-100 transition-opacity duration-300 group-hover:opacity-80"
        ></span>
      </LinkButton>
    </div>
  </main>

  <Footer />

  <style lang="postcss">
    /* ===== Featured & Recent Posts Sections ===== */
    #featured,
    #filtered,
    #recent-posts {
      @apply pb-8 pt-16;
    }
    
    /* Section transitions and animations */
    section {
      @apply transition-all duration-300;
    }
    
    /* Button wrapper styling */
    .all-posts-btn-wrapper {
      @apply my-12 text-center;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      #featured,
      #filtered,
      #recent-posts {
        @apply pb-6 pt-12;
      }
    }
    
    /* Reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      .transform,
      [data-aos] {
        @apply transform-none transition-none;
      }
    }
  </style>
</Layout>
