---
/**
 * Homepage Component (2025 Edition)
 *
 * The main landing page for the Gesundes Leben blog.
 * Features a modern hero section, dynamic blog filter, and enhanced content presentation.
 */

import Layout from "@/layouts/Layout.astro";
import Header from "@/components/sections/Header.astro";
import Footer from "@/components/sections/Footer.astro";
import { SITE } from "@/config";
import Hr from "@/components/elements/Hr.astro";
import BlogFilter from "@/components/filter/BlogFilter.astro";
import Card from "@/components/sections/Card.astro";
import LinkButton from "@/components/elements/LinkButton.astro";
import HeroSection from "@/components/sections/HeroSection.astro";
import { postService } from "@/services/content/PostService";
import { Icon } from "astro-icon/components";

// Fetch and process posts using the PostService
const posts = await postService.getAllPosts();
const sortedPosts = await postService.getSortedPosts(posts);

// Get featured and recent posts using the PostService
const featuredPosts = await postService.getFeaturedPosts(sortedPosts);
const recentPosts = await postService.getRecentPosts(sortedPosts);
---

<Layout>
  <Header />
  <main id="main-content" class="relative overflow-hidden">
    {/* Background decorative elements */}
    <div
      class="absolute -top-24 -right-24 h-64 w-64 rounded-full bg-skin-accent/5 blur-3xl"
    >
    </div>
    <div
      class="absolute top-1/3 -left-32 h-96 w-96 rounded-full bg-skin-accent/5 blur-3xl"
    >
    </div>

    {/* Hero Section with enhanced styling */}
    <div class="relative z-10">
      <HeroSection />
    </div>

    <Hr />

    {/* Filter Explanation Accordion */}
    <div
      class="filter-accordion mx-auto max-w-3xl mt-4 mb-8 rounded-lg border border-skin-accent/20 bg-skin-fill/60 shadow-sm backdrop-blur-md overflow-hidden"
    >
      <button
        id="accordion-button"
        class="accordion-button w-full flex items-center justify-between px-6 py-4 text-left font-medium text-skin-base hover:bg-skin-accent/10 transition-all duration-300"
        aria-expanded="false"
        aria-controls="accordion-content"
      >
        <span class="flex items-center gap-2">
          <Icon name="tabler:info-circle" class="h-5 w-5 text-skin-accent" />
          <span>Wie funktionieren die Filter?</span>
        </span>
        <Icon
          name="tabler:chevron-down"
          id="accordion-icon"
          class="h-5 w-5 text-skin-accent transform transition-transform duration-300"
        />
      </button>

      <div
        id="accordion-content"
        class="accordion-content hidden px-6 pb-6 pt-0 text-skin-base"
        aria-hidden="true"
      >
        <div
          class="prose prose-lg max-w-none prose-headings:text-skin-accent prose-a:text-skin-accent"
        >
          <h3>So funktionieren unsere Filterfunktionen</h3>

          <h4>Grundlegende Filterung</h4>
          <ul>
            <li>
              <strong>Gruppenfilter</strong>: Oben siehst du drei Gruppen (Pro,
              Fragezeiten, Kontra). Klicke auf eine Gruppe, um nur Beiträge
              dieser Gruppe anzuzeigen.
            </li>
            <li>
              <strong>Kategoriefilter</strong>: Unter den Gruppen findest du
              Kategoriebuttons. Klicke auf eine Kategorie, um Beiträge zu diesem
              Thema zu filtern.
            </li>
          </ul>

          <h4>Doppelte Filterung</h4>
          <p>
            Du kannst jetzt <strong
              >gleichzeitig nach Gruppe und Kategorie filtern</strong
            >! Wenn du zum Beispiel "Pro" als Gruppe und "Immunsystem" als
            Kategorie auswählst, werden nur Beiträge angezeigt, die SOWOHL zur
            Gruppe "Pro" gehören ALS AUCH das Thema "Immunsystem" behandeln.
          </p>

          <h4>Alle Filter zurücksetzen</h4>
          <p>
            Klicke auf den Button "Alle" bei den Kategorien, um sämtliche Filter
            zurückzusetzen und wieder alle Beiträge anzuzeigen.
          </p>

          <h4>Nur nach Kategorie filtern</h4>
          <p>
            Wenn du nur nach einer bestimmten Kategorie filtern möchtest, ohne
            eine Gruppe auszuwählen, kannst du das jetzt auch! Wähle einfach
            eine Kategorie aus, ohne vorher eine Gruppe anzuklicken.
          </p>

          <h4>Gruppenauswahl umschalten</h4>
          <p>
            Wenn du eine bereits ausgewählte Gruppe nochmals anklickst, wird die
            Auswahl aufgehoben. So kannst du schnell zwischen Gruppenfilterung
            und keiner Gruppenfilterung wechseln.
          </p>

          <h4>Tipps zur Nutzung</h4>
          <ol>
            <li>
              Beginne mit einer breiten Auswahl (z.B. nur eine Gruppe) und
              verfeinere dann mit Kategorien.
            </li>
            <li>Nutze "Alle", wenn du wieder von vorne beginnen möchtest.</li>
            <li>
              Wenn du alle Beiträge zu einem bestimmten Thema sehen willst,
              unabhängig von der Gruppe, wähle einfach nur die gewünschte
              Kategorie aus.
            </li>
          </ol>
        </div>
      </div>
    </div>

    <Hr />

    {/* Blog Filter Section */}
    <div class="relative z-10 backdrop-blur-sm">
      <BlogFilter />
    </div>

    {/* Featured Articles Section */}
    {
      featuredPosts.length > 0 && (
        <section
          id="featured"
          class="relative z-10"
          data-aos="fade-up"
          data-aos-duration="800"
        >
          <div class="flex items-center gap-3">
            <Icon name="tabler:star" class="h-7 w-7 text-skin-accent" />
            <h2 class="text-3xl font-bold tracking-tight">
              Ausgewählte Artikel
            </h2>
          </div>

          <div class="mt-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-2">
            {featuredPosts.map((post, index) => (
              <div
                data-aos="fade-up"
                data-aos-delay={index * 100}
                class="transform transition-all duration-300 hover:translate-y-[-4px]"
              >
                <Card post={post} loading="lazy" />
              </div>
            ))}
          </div>
        </section>
      )
    }

    {/* Recent Articles Section */}
    {
      recentPosts.length > 0 && (
        <>
          <Hr />
          <section
            id="recent-posts"
            class="relative z-10"
            data-aos="fade-up"
            data-aos-duration="800"
          >
            <div class="flex items-center gap-3">
              <Icon name="tabler:clock" class="h-7 w-7 text-skin-accent" />
              <h2 class="text-3xl font-bold tracking-tight">Neueste Artikel</h2>
            </div>

            <div class="mt-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
              {recentPosts.map(
                (post, index) =>
                  index < SITE.postPerIndex && (
                    <div
                      data-aos="fade-up"
                      data-aos-delay={index * 100}
                      class="transform transition-all duration-300 hover:translate-y-[-4px]"
                    >
                      <Card post={post} loading="lazy" />
                    </div>
                  )
              )}
            </div>
          </section>
        </>
      )
    }

    <Hr />

    {/* All Posts Button */}
    <div
      class="all-posts-btn-wrapper"
      data-aos="fade-up"
      data-aos-duration="600"
    >
      <LinkButton
        href="/posts/"
        className="group relative overflow-hidden rounded-lg bg-skin-accent px-6 py-3 font-medium text-skin-inverted shadow-md transition-all duration-300 hover:shadow-lg"
      >
        <span class="relative z-10 flex items-center gap-2">
          Alle Artikel
          <Icon
            name="tabler:arrow-right"
            class="h-5 w-5 transform transition-transform duration-300 group-hover:translate-x-1"
          />
        </span>
        <span
          class="absolute inset-0 -z-10 bg-gradient-to-r from-skin-accent to-skin-accent/80 opacity-100 transition-opacity duration-300 group-hover:opacity-80"
        ></span>
      </LinkButton>
    </div>
  </main>

  <Footer />

  <style lang="postcss">
    /* ===== Featured & Recent Posts Sections ===== */
    #featured,
    #filtered,
    #recent-posts {
      @apply pb-8 pt-16;
    }
    
    /* Section transitions and animations */
    section {
      @apply transition-all duration-300;
    }
    
    /* Button wrapper styling */
    .all-posts-btn-wrapper {
      @apply my-12 text-center;
    }
    
    /* Accordion styling */
    .filter-accordion {
      @apply transition-all duration-300;
    }
    
    .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-in-out, padding 0.3s ease;
    }
    
    .accordion-content.open {
      max-height: 2000px; /* Large enough to contain content */
      @apply pt-4;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      #featured,
      #filtered,
      #recent-posts {
        @apply pb-6 pt-12;
      }
    }
    
    /* Reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      .transform,
      [data-aos] {
        @apply transform-none transition-none;
      }
      
      .accordion-content {
        transition: none;
      }
    }
  </style>

  <script>
    // Accordion functionality
    document.addEventListener("astro:page-load", () => {
      const accordionButton = document.getElementById("accordion-button");
      const accordionContent = document.getElementById("accordion-content");
      const accordionIcon = document.getElementById("accordion-icon");

      if (accordionButton && accordionContent && accordionIcon) {
        accordionButton.addEventListener("click", () => {
          // Toggle aria-expanded
          const expanded =
            accordionButton.getAttribute("aria-expanded") === "true";
          accordionButton.setAttribute("aria-expanded", (!expanded).toString());
          accordionContent.setAttribute("aria-hidden", expanded.toString());

          // Toggle content visibility
          accordionContent.classList.toggle("hidden");
          accordionContent.classList.toggle("open");

          // Rotate icon
          accordionIcon.style.transform = expanded ? "" : "rotate(180deg)";
        });
      }
    });
  </script>
</Layout>
