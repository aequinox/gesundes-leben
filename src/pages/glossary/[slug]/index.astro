---
import { type CollectionEntry, getCollection } from "astro:content";
import Glossary from "@/layouts/Glossary.astro";
import GlossaryDetails from "@/layouts/GlossaryDetails.astro";
import { paginationService } from "@/services/content/PaginationService";

export interface Props {
  glossaryEntry: CollectionEntry<"glossary">;
}

export async function getStaticPaths() {
  const glossaryEntries: CollectionEntry<"glossary">[] =
    await getCollection("glossary");

  const glossaryEntryResult = glossaryEntries.map(glossaryEntry => ({
    params: { slug: glossaryEntry.slug },
    props: { glossaryEntry },
  }));

  const pagePaths = paginationService
    .calculatePageNumbers(glossaryEntries.length)
    .map(pageNum => ({
      params: { slug: String(pageNum) },
    }));

  return [...glossaryEntryResult, ...pagePaths];
}

const { slug } = Astro.params;
const { glossaryEntry } = Astro.props;

const glossaryEntries: CollectionEntry<"glossary">[] =
  await getCollection("glossary");

const sortedGlossaryEntries = glossaryEntries.sort((a, b) =>
  a.data.title.localeCompare(b.data.title)
);

const pagination = paginationService.generatePagination({
  posts: sortedGlossaryEntries,
  page: slug,
});
---

{
  glossaryEntry ? (
    <GlossaryDetails glossaryEntry={glossaryEntry} />
  ) : (
    <Glossary {...pagination} />
  )
}
