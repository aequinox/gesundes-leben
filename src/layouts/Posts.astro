---
import type { CollectionEntry } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Main from "@/layouts/Main.astro";
import Footer from "@/components/sections/Footer.astro";
import Header from "@/components/sections/Header.astro";
import Pagination from "@/components/sections/Pagination.astro";
import Card from "@/components/sections/Card.astro";
import { SITE } from "@/config";

export interface Props {
  title?: string;
  pageTitle?: string;
  currentPage: number;
  totalPages: number;
  paginatedPosts: CollectionEntry<"blog">[];
}

const {
  title: propTitle,
  pageTitle: propPageTitle,
  currentPage,
  totalPages,
  paginatedPosts,
} = Astro.props;

const title = propTitle
  ? `${propTitle} | ${SITE.title}`
  : `Posts | ${SITE.title}`;
const pageTitle = propPageTitle || propTitle || "Alle Artikel";
---

<Layout title={title}>
  <Header activeNav="posts" />
  <Main
    pageTitle={pageTitle}
    pageDesc={pageTitle.startsWith("Kategorie:")
      ? `Artikel in der Kategorie ${pageTitle.replace("Kategorie: ", "")}`
      : "Alle Artikel in unserem Blog"}
  >
    <div class="mt-6 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
      {paginatedPosts.map(post => <Card post={post} />)}
    </div>
  </Main>

  {/* Get category parameter from URL if it exists */}
  {
    (() => {
      const url = new URL(Astro.request.url);
      const categoryParam = url.searchParams.get("category");
      const categoryQueryString = categoryParam
        ? `?category=${categoryParam}`
        : "";

      return (
        <Pagination
          {currentPage}
          {totalPages}
          prevUrl={`/posts${currentPage - 1 !== 1 ? "/" + (currentPage - 1) : ""}${categoryQueryString}`}
          nextUrl={`/posts/${currentPage + 1}${categoryQueryString}`}
        />
      );
    })()
  }

  <Footer noMarginTop={totalPages > 1} />
</Layout>
